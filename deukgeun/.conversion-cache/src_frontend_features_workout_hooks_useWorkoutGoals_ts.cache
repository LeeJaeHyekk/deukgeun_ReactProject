{"key":"8bd925ddfd6beda37ec5c64416b06212","result":"const { useState, useEffect, useCallback  } = require('react')\r\nconst { workoutApi  } = require('../api/workoutApi')\r\nimport type { WorkoutGoal } from '../types'\r\n\r\nexport function useWorkoutGoals() {\r\n  const [goals, setGoals] = useState<WorkoutGoal[]>([])\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const getUserGoals = useCallback(async () => {\r\n    console.log(`ğŸ” [useWorkoutGoals] getUserGoals í˜¸ì¶œ ì‹œì‘`)\r\n    try {\r\n      setLoading(true)\r\n      setError(null)\r\n\r\n      console.log(`ğŸ“¡ [useWorkoutGoals] API í˜¸ì¶œ ì¤‘...`)\r\n      const data = await workoutApi.getGoals()\r\n      console.log(`âœ… [useWorkoutGoals] ìš´ë™ ëª©í‘œ ${data.length}ê°œ ì¡°íšŒ ì„±ê³µ`)\r\n      setGoals(data)\r\n    } catch (err) {\r\n      const errorMessage =\r\n        err instanceof Error\r\n          ? err.message\r\n          : 'ìš´ë™ ëª©í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'\r\n      console.error(`âŒ [useWorkoutGoals] ìš´ë™ ëª©í‘œ ì¡°íšŒ ì‹¤íŒ¨:`, err)\r\n      setError(errorMessage)\r\n    } finally {\r\n      setLoading(false)\r\n      console.log(`ğŸ [useWorkoutGoals] getUserGoals ì™„ë£Œ`)\r\n    }\r\n  }, [])\r\n\r\n  const createGoal = useCallback(async (goalData: Partial<WorkoutGoal>) => {\r\n    const requestId = Math.random().toString(36).substring(2, 15)\r\n    console.log(`ğŸ” [useWorkoutGoals:${requestId}] createGoal ì‹œì‘`, {\r\n      goalData,\r\n    })\r\n\r\n    try {\r\n      setLoading(true)\r\n      setError(null)\r\n      // userIdëŠ” ë°±ì—”ë“œì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¡œ ì„¤ì •í•˜ë¯€ë¡œ ì œê±°\r\n      const { userId, ...createData } = goalData\r\n      console.log(\r\n        `ğŸ“ [useWorkoutGoals:${requestId}] API í˜¸ì¶œìš© ë°ì´í„°:`,\r\n        createData\r\n      )\r\n\r\n      console.log(\r\n        `ğŸ“¡ [useWorkoutGoals:${requestId}] workoutApi.createGoal í˜¸ì¶œ`\r\n      )\r\n      const newGoal = await workoutApi.createGoal(createData as any)\r\n\r\n      console.log(`âœ… [useWorkoutGoals:${requestId}] ëª©í‘œ ìƒì„± ì„±ê³µ:`, newGoal)\r\n      setGoals(prev => {\r\n        const updated = [newGoal, ...prev]\r\n        console.log(\r\n          `ğŸ“ [useWorkoutGoals:${requestId}] ëª©í‘œ ëª©ë¡ ì—…ë°ì´íŠ¸:`,\r\n          updated\r\n        )\r\n        return updated\r\n      })\r\n      return newGoal\r\n    } catch (err) {\r\n      console.error(\r\n        `âŒ [useWorkoutGoals:${requestId}] ìš´ë™ ëª©í‘œ ìƒì„± ì‹¤íŒ¨:`,\r\n        err\r\n      )\r\n      const errorMessage =\r\n        err instanceof Error ? err.message : 'ìš´ë™ ëª©í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'\r\n      setError(errorMessage)\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n      console.log(`ğŸ [useWorkoutGoals:${requestId}] createGoal ì™„ë£Œ`)\r\n    }\r\n  }, [])\r\n\r\n  const updateGoal = useCallback(\r\n    async (goalId: number, goalData: Partial<WorkoutGoal>) => {\r\n      try {\r\n        setLoading(true)\r\n        setError(null)\r\n        // goalIdê°€ í•„ìˆ˜ì´ë¯€ë¡œ ì¶”ê°€\r\n        const updateData = {\r\n          ...goalData,\r\n          goalId,\r\n        } as any\r\n        const updatedGoal = await workoutApi.updateGoal(goalId, updateData)\r\n        setGoals(prev =>\r\n          prev.map(goal => (goal.goal_id === goalId ? updatedGoal : goal))\r\n        )\r\n        return updatedGoal\r\n      } catch (err) {\r\n        const errorMessage =\r\n          err instanceof Error\r\n            ? err.message\r\n            : 'ìš´ë™ ëª©í‘œ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'\r\n        console.error('ìš´ë™ ëª©í‘œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', err)\r\n        setError(errorMessage)\r\n        throw err\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    },\r\n    []\r\n  )\r\n\r\n  const deleteGoal = useCallback(async (goalId: number) => {\r\n    try {\r\n      setLoading(true)\r\n      setError(null)\r\n\r\n      // ê°œë°œ í™˜ê²½ì—ì„œ ë”ë¯¸ ë°ì´í„° ì²˜ë¦¬\r\n      if (\r\n        process.env.MODE === 'development' &&\r\n        (goalId === 1 || goalId === 2)\r\n      ) {\r\n        console.log(`ğŸ”§ ê°œë°œ í™˜ê²½ - ë”ë¯¸ ëª©í‘œ ì‚­ì œ ì²˜ë¦¬: ${goalId}`)\r\n        setGoals(prev => prev.filter(goal => goal.goal_id !== goalId))\r\n        return\r\n      }\r\n\r\n      await workoutApi.deleteGoal(goalId)\r\n      setGoals(prev => prev.filter(goal => goal.goal_id !== goalId))\r\n    } catch (err) {\r\n      const errorMessage =\r\n        err instanceof Error ? err.message : 'ìš´ë™ ëª©í‘œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'\r\n      console.error('ìš´ë™ ëª©í‘œ ì‚­ì œ ì‹¤íŒ¨:', err)\r\n      setError(errorMessage)\r\n      throw err\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const clearError = useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    getUserGoals()\r\n  }, [getUserGoals])\r\n\r\n  return {\r\n    goals,\r\n    loading,\r\n    error,\r\n    getUserGoals,\r\n    createGoal,\r\n    updateGoal,\r\n    deleteGoal,\r\n    clearError,\r\n  }\r\n}\r\n","timestamp":1759820789639}