{"key":"cf188aeaad8e2a54dc8424e53b2d10e3","result":"// Browser API polyfills for Node.js environment\nif (typeof window === 'undefined') {\n  global.window = global.window || {}\n  global.document = global.document || {}\n  global.localStorage = global.localStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.sessionStorage = global.sessionStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.File = global.File || class File {}\n  global.StorageEvent = global.StorageEvent || class StorageEvent {}\n  global.requestAnimationFrame = global.requestAnimationFrame || (cb => setTimeout(cb, 16))\n}\n\nimport React, { Component, ErrorInfo, ReactNode } from \"react\"\r\nconst ErrorPage = require('./ErrorPage').default\r\n\r\ninterface Props {\r\n  children: ReactNode\r\n  fallback?: ReactNode\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean\r\n  error?: Error\r\n  errorInfo?: ErrorInfo\r\n}\r\n\r\nexport class ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props)\r\n    this.state = { hasError: false }\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): State {\r\n    // ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ì—¬ ë‹¤ìŒ ë Œë”ë§ì—ì„œ í´ë°± UIë¥¼ í‘œì‹œ\r\n    return { hasError: true, error }\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // ì—ëŸ¬ ë¡œê¹…\r\n    console.error(\"ErrorBoundary caught an error:\", error, errorInfo)\r\n\r\n    // ì—ëŸ¬ ì •ë³´ë¥¼ ìƒíƒœì— ì €ì¥\r\n    this.setState({ error, errorInfo })\r\n\r\n    // ì‚¬ìš©ì ì •ì˜ ì—ëŸ¬ í•¸ë“¤ëŸ¬ í˜¸ì¶œ\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo)\r\n    }\r\n\r\n    // ì—ëŸ¬ ë¦¬í¬íŒ… (ì„ íƒì‚¬í•­)\r\n    this.reportError(error, errorInfo)\r\n  }\r\n\r\n  private reportError = (error: Error, errorInfo: ErrorInfo) => {\r\n    // ì—ëŸ¬ ë¦¬í¬íŒ… ë¡œì§ (ì˜ˆ: Sentry, LogRocket ë“±)\r\n    try {\r\n      // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì½˜ì†”ì— ì¶œë ¥\r\n      if (process.env.DEV) {\r\n        console.group(\"ğŸš¨ Error Boundary Report\")\r\n        console.error(\"Error:\", error)\r\n        console.error(\"Error Info:\", errorInfo)\r\n        console.error(\"Component Stack:\", errorInfo.componentStack)\r\n        console.groupEnd()\r\n      }\r\n\r\n      // í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì—ëŸ¬ ë¦¬í¬íŒ… ì„œë¹„ìŠ¤ë¡œ ì „ì†¡\r\n      if (process.env.PROD) {\r\n        // ì˜ˆì‹œ: Sentryë¡œ ì—ëŸ¬ ì „ì†¡\r\n        // Sentry.captureException(error, { extra: errorInfo })\r\n\r\n        // ë˜ëŠ” ìì²´ ì—ëŸ¬ ë¡œê¹… API í˜¸ì¶œ\r\n        this.sendErrorToServer(error, errorInfo)\r\n      }\r\n    } catch (reportingError) {\r\n      console.error(\"Error reporting failed:\", reportingError)\r\n    }\r\n  }\r\n\r\n  private sendErrorToServer = async (error: Error, errorInfo: ErrorInfo) => {\r\n    try {\r\n      const errorReport = {\r\n        message: error.message,\r\n        stack: error.stack,\r\n        componentStack: errorInfo.componentStack,\r\n        timestamp: new Date().toISOString(),\r\n        userAgent: navigator.userAgent,\r\n        url: window.location.href,\r\n        // ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸ ì •ë³´\r\n        context: {\r\n          userId: localStorage.getItem(\"userId\") || \"anonymous\",\r\n          sessionId: sessionStorage.getItem(\"sessionId\") || \"unknown\",\r\n        },\r\n      }\r\n\r\n      // ì—ëŸ¬ ë¦¬í¬íŒ… API í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”)\r\n      // await fetch(\"/api/errors\", {\r\n      //   method: \"POST\",\r\n      //   headers: { \"Content-Type\": \"application/json\" },\r\n      //   body: JSON.stringify(errorReport),\r\n      // })\r\n\r\n      console.log(\"Error report prepared:\", errorReport)\r\n    } catch (sendError) {\r\n      console.error(\"Failed to send error to server:\", sendError)\r\n    }\r\n  }\r\n\r\n  private handleRetry = () => {\r\n    // ì—ëŸ¬ ìƒíƒœë¥¼ ë¦¬ì…‹í•˜ê³  ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§\r\n    this.setState({ hasError: false, error: undefined, errorInfo: undefined })\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // ì‚¬ìš©ì ì •ì˜ í´ë°± UIê°€ ìˆìœ¼ë©´ ì‚¬ìš©\r\n      if (this.props.fallback) {\r\n        return this.props.fallback\r\n      }\r\n\r\n      // ê¸°ë³¸ ì—ëŸ¬ í˜ì´ì§€ í‘œì‹œ\r\n      return (\r\n        <ErrorPage\r\n          statusCode={500}\r\n          title=\"ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜\"\r\n          message=\"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\"\r\n          showRetryButton={true}\r\n          onRetry={this.handleRetry}\r\n        />\r\n      )\r\n    }\r\n\r\n    return this.props.children\r\n  }\r\n}\r\n\r\n// í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ë¥¼ ìœ„í•œ ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ë˜í¼\r\nexport function withErrorBoundary<P extends object>(\r\n  Component: React.ComponentType<P>,\r\n  errorBoundaryProps?: Partial<Props>\r\n) {\r\n  return function WrappedComponent(props: P) {\r\n    return (\r\n      <ErrorBoundary {...errorBoundaryProps}>\r\n        <Component {...props} />\r\n      </ErrorBoundary>\r\n    )\r\n  }\r\n}\r\n\r\n// í›… ê¸°ë°˜ ì—ëŸ¬ ë°”ìš´ë”ë¦¬ (í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ìš©)\r\nexport function useErrorBoundary() {\r\n  const [error, setError] = React.useState<Error | null>(null)\r\n\r\n  const handleError = React.useCallback(\r\n    (error: Error, errorInfo: ErrorInfo) => {\r\n      console.error(\"useErrorBoundary caught an error:\", error, errorInfo)\r\n      setError(error)\r\n    },\r\n    []\r\n  )\r\n\r\n  const resetError = React.useCallback(() => {\r\n    setError(null)\r\n  }, [])\r\n\r\n  return {\r\n    error,\r\n    handleError,\r\n    resetError,\r\n  }\r\n}\r\n\r\n// ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ì»¨í…ìŠ¤íŠ¸\r\ninterface ErrorBoundaryContextType {\r\n  reportError: (error: Error, errorInfo?: ErrorInfo) => void\r\n  clearError: () => void\r\n  hasError: boolean\r\n}\r\n\r\nconst ErrorBoundaryContext =\r\n  React.createContext<ErrorBoundaryContextType | null>(null)\r\n\r\nexport function ErrorBoundaryProvider({ children }: { children: ReactNode }) {\r\n  const [errors, setErrors] = React.useState<\r\n    Array<{ error: Error; errorInfo?: ErrorInfo; timestamp: Date }>\r\n  >([])\r\n\r\n  const reportError = React.useCallback(\r\n    (error: Error, errorInfo?: ErrorInfo) => {\r\n      setErrors(prev => [...prev, { error, errorInfo, timestamp: new Date() }])\r\n    },\r\n    []\r\n  )\r\n\r\n  const clearError = React.useCallback(() => {\r\n    setErrors([])\r\n  }, [])\r\n\r\n  const value = React.useMemo(\r\n    () => ({\r\n      reportError,\r\n      clearError,\r\n      hasError: errors.length > 0,\r\n    }),\r\n    [reportError, clearError, errors.length]\r\n  )\r\n\r\n  return (\r\n    <ErrorBoundaryContext.Provider value={value}>\r\n      {children}\r\n    </ErrorBoundaryContext.Provider>\r\n  )\r\n}\r\n\r\nexport function useErrorBoundaryContext() {\r\n  const context = React.useContext(ErrorBoundaryContext)\r\n  if (!context) {\r\n    throw new Error(\r\n      \"useErrorBoundaryContext must be used within ErrorBoundaryProvider\"\r\n    )\r\n  }\r\n  return context\r\n}\r\n\r\nmodule.exports.default = ErrorBoundary\r\n","timestamp":1759820789675}