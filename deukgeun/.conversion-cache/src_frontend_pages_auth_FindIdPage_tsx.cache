{"key":"3acca76412c73eed47522991dd72cde2","result":"// Browser API polyfills for Node.js environment\nif (typeof window === 'undefined') {\n  global.window = global.window || {}\n  global.document = global.document || {}\n  global.localStorage = global.localStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.sessionStorage = global.sessionStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.File = global.File || class File {}\n  global.StorageEvent = global.StorageEvent || class StorageEvent {}\n  global.requestAnimationFrame = global.requestAnimationFrame || (cb => setTimeout(cb, 16))\n}\n\nimport React, { useState, useEffect } from 'react'\r\nconst { useNavigate  } = require('react-router-dom')\r\nconst { FaArrowLeft  } = require('react-icons/fa')\r\nconst DatePicker = require('react-datepicker').default\r\nimport 'react-datepicker/dist/react-datepicker.css'\r\nconst { useAccountRecovery  } = require('@features/auth/hooks/useAccountRecovery')\r\nconst { useAuthContext  } = require('@frontend/shared/contexts/AuthContext')\r\nconst { RecaptchaWidget  } = require('@frontend/shared/components/RecaptchaWidget')\r\nconst { showToast  } = require('@frontend/shared/lib')\r\nconst styles = require('./FindIdPage.module.css').default\r\n\r\n// ì „í™”ë²ˆí˜¸ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜\r\nfunction formatPhoneNumber(value: string): string {\r\n  // ìˆ«ìë§Œ ì¶”ì¶œ\r\n  const numbers = value.replace(/[^\\d]/g, '')\r\n\r\n  // ê¸¸ì´ì— ë”°ë¼ í¬ë§·íŒ…\r\n  if (numbers.length <= 3) {\r\n    return numbers\r\n  } else if (numbers.length <= 7) {\r\n    return `${numbers.slice(0, 3)}-${numbers.slice(3)}`\r\n  } else {\r\n    return `${numbers.slice(0, 3)}-${numbers.slice(3, 7)}-${numbers.slice(7, 11)}`\r\n  }\r\n}\r\n\r\nmodule.exports.default = function FindIdPage() {\r\n  const navigate = useNavigate()\r\n  const { isAuthenticated, isLoading } = useAuthContext()\r\n  const { state, findIdSimple, reset } = useAccountRecovery()\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    phone: '',\r\n    gender: '',\r\n    birthday: '',\r\n  })\r\n  const [recaptchaToken, setRecaptchaToken] = useState<string | null>(null)\r\n  const [errors, setErrors] = useState<{\r\n    name?: string\r\n    phone?: string\r\n    recaptcha?: string\r\n  }>({})\r\n\r\n  // ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ì ‘ê·¼ ì‹œ ë©”ì¸í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      console.log('ğŸ§ª ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ - ë©”ì¸í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸')\r\n      navigate('/', { replace: true })\r\n    }\r\n  }, [isAuthenticated, navigate])\r\n\r\n  // DatePicker ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ ì§ì ‘ ì ìš©\r\n  useEffect(() => {\r\n    const applyDatePickerStyles = () => {\r\n      const navigationIcons = document.querySelectorAll(\r\n        '.react-datepicker__navigation-icon'\r\n      )\r\n      const previousIcons = document.querySelectorAll(\r\n        '.react-datepicker__navigation-icon--previous'\r\n      )\r\n      const nextIcons = document.querySelectorAll(\r\n        '.react-datepicker__navigation-icon--next'\r\n      )\r\n\r\n      navigationIcons.forEach(icon => {\r\n        ;(icon as HTMLElement).style.position = 'absolute'\r\n        ;(icon as HTMLElement).style.top = '50%'\r\n        ;(icon as HTMLElement).style.left = '50%'\r\n      })\r\n\r\n      previousIcons.forEach(icon => {\r\n        ;(icon as HTMLElement).style.transform =\r\n          'translate(-50%, -50%) rotate(180deg)'\r\n      })\r\n\r\n      nextIcons.forEach(icon => {\r\n        ;(icon as HTMLElement).style.transform =\r\n          'translate(-50%, -50%) rotate(0deg)'\r\n      })\r\n    }\r\n\r\n    // ì´ˆê¸° ì ìš©\r\n    applyDatePickerStyles()\r\n\r\n    // MutationObserverë¡œ DatePickerê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë  ë•Œë§ˆë‹¤ ìŠ¤íƒ€ì¼ ì ìš©\r\n    const observer = new MutationObserver(mutations => {\r\n      mutations.forEach(mutation => {\r\n        if (mutation.type === 'childList') {\r\n          const datepicker = document.querySelector('.react-datepicker')\r\n          if (datepicker) {\r\n            applyDatePickerStyles()\r\n          }\r\n        }\r\n      })\r\n    })\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    })\r\n\r\n    return () => observer.disconnect()\r\n  }, [])\r\n\r\n  // ì „í™”ë²ˆí˜¸ ì…ë ¥ í•¸ë“¤ëŸ¬\r\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const formattedPhone = formatPhoneNumber(e.target.value)\r\n    setFormData(prev => ({ ...prev, phone: formattedPhone }))\r\n    if (errors.phone) {\r\n      setErrors(prev => ({ ...prev, phone: undefined }))\r\n    }\r\n  }\r\n\r\n  // ìƒë…„ì›”ì¼ ë³€ê²½ í•¸ë“¤ëŸ¬\r\n  const handleBirthdayChange = (date: Date | null) => {\r\n    if (date) {\r\n      const formattedDate = date.toISOString().split('T')[0]\r\n      setFormData(prev => ({ ...prev, birthday: formattedDate }))\r\n    } else {\r\n      setFormData(prev => ({ ...prev, birthday: '' }))\r\n    }\r\n  }\r\n\r\n  // ìƒë…„ì›”ì¼ ì§ì ‘ ì…ë ¥ í•¸ë“¤ëŸ¬\r\n  const handleBirthdayInputChange = (\r\n    e: React.ChangeEvent<HTMLInputElement>\r\n  ) => {\r\n    let inputValue = e.target.value.replace(/[^\\d]/g, '') // ìˆ«ìë§Œ ì¶”ì¶œ\r\n\r\n    // ê¸¸ì´ì— ë”°ë¼ í¬ë§·íŒ…\r\n    if (inputValue.length <= 4) {\r\n      // 4ì ì´í•˜ì¼ ë•ŒëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€\r\n    } else if (inputValue.length <= 6) {\r\n      inputValue = `${inputValue.slice(0, 4)}-${inputValue.slice(4)}`\r\n    } else {\r\n      inputValue = `${inputValue.slice(0, 4)}-${inputValue.slice(4, 6)}-${inputValue.slice(6, 8)}`\r\n    }\r\n\r\n    setFormData(prev => ({ ...prev, birthday: inputValue }))\r\n  }\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: { name?: string; phone?: string; recaptcha?: string } = {}\r\n\r\n    if (!formData.name.trim()) {\r\n      newErrors.name = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    }\r\n\r\n    if (!formData.phone.trim()) {\r\n      newErrors.phone = 'íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    } else if (\r\n      !/^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/.test(formData.phone.replace(/-/g, ''))\r\n    ) {\r\n      newErrors.phone = 'ìœ íš¨í•œ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    }\r\n\r\n    if (!recaptchaToken) {\r\n      newErrors.recaptcha = 'ë³´ì•ˆ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.'\r\n    }\r\n\r\n    setErrors(newErrors)\r\n    return Object.keys(newErrors).length === 0\r\n  }\r\n\r\n  const handleFindId = async () => {\r\n    if (!validateForm()) {\r\n      return\r\n    }\r\n\r\n    const submitData = {\r\n      name: formData.name.trim(),\r\n      phone: formData.phone.trim(),\r\n      gender: (formData.gender as 'male' | 'female' | 'other') || undefined,\r\n      birthday: formData.birthday || undefined,\r\n      recaptchaToken: recaptchaToken!,\r\n    }\r\n\r\n    console.log('ğŸ§ª ì•„ì´ë”” ì°¾ê¸° ìš”ì²­:', submitData)\r\n\r\n    await findIdSimple(submitData)\r\n  }\r\n\r\n  const handleRecaptchaChange = (token: string | null) => {\r\n    // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë”ë¯¸ í† í° ì‚¬ìš©\r\n    const finalToken = process.env.DEV\r\n      ? 'dummy-token-for-development'\r\n      : token\r\n\r\n    console.log('ğŸ§ª reCAPTCHA í† í° ë³€ê²½:', {\r\n      originalToken: token,\r\n      finalToken,\r\n    })\r\n    setRecaptchaToken(finalToken)\r\n    // reCAPTCHA ì™„ë£Œ ì‹œ í•´ë‹¹ ì—ëŸ¬ ì´ˆê¸°í™”\r\n    if (finalToken && errors.recaptcha) {\r\n      setErrors(prev => ({ ...prev, recaptcha: undefined }))\r\n    }\r\n  }\r\n\r\n  // ë¡œë”© ì¤‘ì¼ ë•Œ ìŠ¤í”¼ë„ˆ í‘œì‹œ\r\n  if (isLoading) {\r\n    return (\r\n      <div className={styles.pageWrapper}>\r\n        <div className={styles.findIdBox}>\r\n          <div style={{ textAlign: 'center', color: '#f1f3f5' }}>\r\n            <p>ì¸ì¦ í™•ì¸ ì¤‘...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¼ë©´ ë¡œë”© í™”ë©´ í‘œì‹œ\r\n  if (isAuthenticated) {\r\n    return (\r\n      <div className={styles.pageWrapper}>\r\n        <div className={styles.findIdBox}>\r\n          <div style={{ textAlign: 'center', color: '#f1f3f5' }}>\r\n            <p>ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì…ë‹ˆë‹¤.</p>\r\n            <p>ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™ ì¤‘...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ê²°ê³¼ í™”ë©´\r\n  if (state.step === 'result') {\r\n    return (\r\n      <div className={styles.pageWrapper}>\r\n        <div className={styles.findIdBox}>\r\n          <button\r\n            onClick={() => navigate('/login')}\r\n            className={styles.backButton}\r\n            aria-label=\"ë’¤ë¡œ ê°€ê¸°\"\r\n          >\r\n            <FaArrowLeft />\r\n          </button>\r\n\r\n          <h1 className={styles.title}>ì•„ì´ë”” ì°¾ê¸° ì™„ë£Œ</h1>\r\n          <p className={styles.description}>\r\n            ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ì°¾ì€ ì•„ì´ë””ì…ë‹ˆë‹¤.\r\n          </p>\r\n\r\n          <div className={styles.resultContainer}>\r\n            <div className={styles.successMessage}>\r\n              <strong>ì°¾ì€ ì•„ì´ë””:</strong>\r\n              <br />\r\n              <span className={styles.foundId}>\r\n                {state.data?.username || 'ì•„ì´ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={styles.linkRow}>\r\n            <button onClick={() => reset('find-id')} className={styles.linkBtn}>\r\n              ë‹¤ì‹œ ì‹œë„\r\n            </button>\r\n            <button\r\n              onClick={() => navigate('/login')}\r\n              className={styles.linkBtn}\r\n            >\r\n              ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°\r\n            </button>\r\n            <button\r\n              onClick={() => navigate('/find-password')}\r\n              className={styles.linkBtn}\r\n            >\r\n              ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={styles.pageWrapper}>\r\n      <div className={styles.findIdBox}>\r\n        <button\r\n          onClick={() => navigate('/login')}\r\n          className={styles.backButton}\r\n          aria-label=\"ë’¤ë¡œ ê°€ê¸°\"\r\n        >\r\n          <FaArrowLeft />\r\n        </button>\r\n\r\n        <h1 className={styles.title}>ì•„ì´ë”” ì°¾ê¸°</h1>\r\n        <p className={styles.description}>\r\n          ê°€ì… ì‹œ ì…ë ¥í•œ ì •ë³´ë¡œ ì•„ì´ë””ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\r\n        </p>\r\n\r\n        <div className={styles.inputGroup}>\r\n          <input\r\n            type=\"text\"\r\n            value={formData.name}\r\n            onChange={e => {\r\n              setFormData(prev => ({ ...prev, name: e.target.value }))\r\n              if (errors.name) {\r\n                setErrors(prev => ({ ...prev, name: undefined }))\r\n              }\r\n            }}\r\n            onKeyDown={e => {\r\n              if (e.key === 'Enter' && !state.loading) {\r\n                e.preventDefault()\r\n                handleFindId()\r\n              }\r\n            }}\r\n            placeholder=\"ì´ë¦„\"\r\n            className={`${styles.input} ${\r\n              errors.name ? styles.inputError : ''\r\n            }`}\r\n          />\r\n          {errors.name && (\r\n            <span className={styles.errorText}>{errors.name}</span>\r\n          )}\r\n        </div>\r\n\r\n        <div className={styles.inputGroup}>\r\n          <input\r\n            type=\"tel\"\r\n            value={formData.phone}\r\n            onChange={handlePhoneChange}\r\n            onKeyDown={e => {\r\n              if (e.key === 'Enter' && !state.loading) {\r\n                e.preventDefault()\r\n                handleFindId()\r\n              }\r\n            }}\r\n            placeholder=\"íœ´ëŒ€í° ë²ˆí˜¸ (010-0000-0000)\"\r\n            className={`${styles.input} ${\r\n              errors.phone ? styles.inputError : ''\r\n            }`}\r\n            maxLength={13}\r\n          />\r\n          {errors.phone && (\r\n            <span className={styles.errorText}>{errors.phone}</span>\r\n          )}\r\n        </div>\r\n\r\n        <div className={styles.inputGroup}>\r\n          <select\r\n            value={formData.gender}\r\n            onChange={e =>\r\n              setFormData(prev => ({ ...prev, gender: e.target.value }))\r\n            }\r\n            className={styles.input}\r\n          >\r\n            <option value=\"\" disabled>\r\n              ì„±ë³„ ì„ íƒ (ì„ íƒì‚¬í•­)\r\n            </option>\r\n            <option value=\"male\">ë‚¨ì„±</option>\r\n            <option value=\"female\">ì—¬ì„±</option>\r\n            <option value=\"other\">ê¸°íƒ€</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className={styles.inputGroup}>\r\n          <DatePicker\r\n            selected={formData.birthday ? new Date(formData.birthday) : null}\r\n            onChange={handleBirthdayChange}\r\n            dateFormat=\"yyyy-MM-dd\"\r\n            placeholderText=\"ìƒë…„ì›”ì¼ (ì„ íƒì‚¬í•­)\"\r\n            className={styles.input}\r\n            maxDate={new Date()}\r\n            showYearDropdown\r\n            showMonthDropdown\r\n            dropdownMode=\"select\"\r\n            yearDropdownItemNumber={100}\r\n            scrollableYearDropdown\r\n            isClearable\r\n            customInput={\r\n              <input\r\n                className={styles.input}\r\n                placeholder=\"ìƒë…„ì›”ì¼ (ì„ íƒì‚¬í•­)\"\r\n                value={formData.birthday}\r\n                onChange={handleBirthdayInputChange}\r\n              />\r\n            }\r\n          />\r\n        </div>\r\n\r\n        <div className={styles.recaptchaContainer}>\r\n          <RecaptchaWidget\r\n            onChange={handleRecaptchaChange}\r\n            className={styles.recaptchaWidget}\r\n            aria-describedby={errors.recaptcha ? 'recaptcha-error' : undefined}\r\n          />\r\n          {errors.recaptcha && (\r\n            <span id=\"recaptcha-error\" className={styles.errorText}>\r\n              {errors.recaptcha}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {state.error && (\r\n          <div className={styles.errorMessage}>{state.error}</div>\r\n        )}\r\n\r\n        <button\r\n          onClick={handleFindId}\r\n          className={styles.findButton}\r\n          disabled={state.loading}\r\n          aria-describedby={state.loading ? 'loading-description' : undefined}\r\n        >\r\n          {state.loading ? 'ì²˜ë¦¬ ì¤‘...' : 'ì•„ì´ë”” ì°¾ê¸°'}\r\n        </button>\r\n        {state.loading && (\r\n          <span id=\"loading-description\" className=\"sr-only\">\r\n            ì•„ì´ë”” ì°¾ê¸° ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.\r\n          </span>\r\n        )}\r\n\r\n        <div className={styles.linkRow}>\r\n          <button onClick={() => navigate('/login')} className={styles.linkBtn}>\r\n            ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°\r\n          </button>\r\n          <button\r\n            onClick={() => navigate('/find-password')}\r\n            className={styles.linkBtn}\r\n          >\r\n            ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","timestamp":1759820789660}