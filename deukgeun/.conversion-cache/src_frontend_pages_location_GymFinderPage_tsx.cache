{"key":"51245a077fe9930ca8dd88ecb07f2c19","result":"// Browser API polyfills for Node.js environment\nif (typeof window === 'undefined') {\n  global.window = global.window || {}\n  global.document = global.document || {}\n  global.localStorage = global.localStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.sessionStorage = global.sessionStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.File = global.File || class File {}\n  global.StorageEvent = global.StorageEvent || class StorageEvent {}\n  global.requestAnimationFrame = global.requestAnimationFrame || (cb => setTimeout(cb, 16))\n}\n\nconst { useState, useEffect, useMemo, useRef  } = require('react')\r\nconst styles = require('./GymFinderPage.module.css').default\r\nconst { Navigation  } = require('@widgets/Navigation/Navigation')\r\nconst { SearchBar  } = require('./components/Map/SearchBar')\r\nconst { FilterTag  } = require('./components/FilterTag/FilterTag')\r\nconst { GymList  } = require('./components/Map/GymList')\r\nconst { fetchGymsByKeyword  } = require('./API/kakao')\r\nconst { Gym, FilterOption, SortOption, SortDirection  } = require('./types')\r\nconst { useAuth  } = require('@shared/hooks/useAuth')\r\nconst { useNavigate  } = require('react-router-dom')\r\nconst { processGyms  } = require('./utils/gymFilters')\r\n\r\n// ì „ì—­ ì„ ì–¸\r\ndeclare global {\r\n  interface Window {\r\n    kakao: any\r\n  }\r\n}\r\n\r\nconst filters: FilterOption[] = [\"PT\", \"GX\", \"24ì‹œê°„\", \"ì£¼ì°¨\", \"ìƒ¤ì›Œ\"]\r\n\r\nmodule.exports.default = function GymFinderPage() {\r\n  const [gyms, setGyms] = useState<Gym[]>([])\r\n  const [position, setPosition] = useState<{ lat: number; lng: number } | null>(\r\n    null\r\n  )\r\n  const [activeFilters, setActiveFilters] = useState<FilterOption[]>([])\r\n  const [sortBy, setSortBy] = useState<SortOption>(\"distance\")\r\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"asc\")\r\n  const [isMapLoaded, setIsMapLoaded] = useState(false)\r\n  const [maxDistance, setMaxDistance] = useState<number>(5) // ê¸°ë³¸ 5km\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const navigate = useNavigate()\r\n  const { isAuthenticated } = useAuth()\r\n\r\n  // ë§µ ê´€ë ¨ refs\r\n  const mapRef = useRef<any>(null)\r\n  const currentLocationMarkerRef = useRef<any>(null)\r\n  const gymMarkersRef = useRef<any[]>([])\r\n\r\n  const kakaoApiKey = process.env.VITE_LOCATION_JAVASCRIPT_MAP_API_KEY\r\n\r\n  console.log(\"ğŸ§ª GymFinderPage ë Œë”ë§\")\r\n  console.log(\"ğŸ§ª í˜„ì¬ gyms ìƒíƒœ:\", gyms.length, \"ê°œ\")\r\n  console.log(\"ğŸ§ª í˜„ì¬ position:\", position)\r\n\r\n  // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°\r\n  useEffect(() => {\r\n    console.log(\"ğŸ§ª ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹œì‘\")\r\n    if (!isAuthenticated) {\r\n      console.log(\"ğŸ§ª ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™\")\r\n      navigate(\"/login\")\r\n      return\r\n    }\r\n\r\n    if (!navigator.geolocation) {\r\n      console.error(\"Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.\")\r\n      return\r\n    }\r\n\r\n    navigator.geolocation.getCurrentPosition(\r\n      pos => {\r\n        const currentPos = {\r\n          lat: pos.coords.latitude,\r\n          lng: pos.coords.longitude,\r\n        }\r\n        console.log(\"ğŸ§ª ìœ„ì¹˜ ì •ë³´ íšë“:\", currentPos)\r\n        setPosition(currentPos)\r\n      },\r\n      error => {\r\n        console.error(\"ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\", error)\r\n      }\r\n    )\r\n  }, [isAuthenticated, navigate])\r\n\r\n  // ìœ„ì¹˜ê°€ ì„¤ì •ë˜ë©´ ê¸°ë³¸ í—¬ìŠ¤ì¥ ê²€ìƒ‰ ì‹¤í–‰\r\n  useEffect(() => {\r\n    if (position && gyms.length === 0) {\r\n      console.log(\"ğŸ§ª ìœ„ì¹˜ ì„¤ì •ë¨, ê¸°ë³¸ í—¬ìŠ¤ì¥ ê²€ìƒ‰ ì‹œì‘\")\r\n      handleSearch(\"í—¬ìŠ¤ì¥\")\r\n    }\r\n  }, [position])\r\n\r\n  // Kakao Maps SDK ë¡œë“œ ë° ë§µ ì´ˆê¸°í™”\r\n  useEffect(() => {\r\n    if (!position || isMapLoaded) return\r\n    if (!kakaoApiKey) {\r\n      console.error(\"âš ï¸ Kakao API Keyê°€ .envì— ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\")\r\n      return\r\n    }\r\n\r\n    const loadKakaoMap = (): Promise<void> => {\r\n      return new Promise((resolve, reject) => {\r\n        if (window.kakao && window.kakao.maps) {\r\n          resolve()\r\n        } else {\r\n          const existingScript = document.getElementById(\"kakao-map-sdk-script\")\r\n          if (existingScript) {\r\n            existingScript.addEventListener(\"load\", () => resolve())\r\n            existingScript.addEventListener(\"error\", () => reject())\r\n            return\r\n          }\r\n\r\n          const script = document.createElement(\"script\")\r\n          script.id = \"kakao-map-sdk-script\"\r\n          script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${kakaoApiKey}&autoload=false`\r\n          script.async = true\r\n\r\n          script.onload = () => resolve()\r\n          script.onerror = error => reject(error)\r\n\r\n          document.head.appendChild(script)\r\n        }\r\n      })\r\n    }\r\n\r\n    const initializeMap = () => {\r\n      const container = document.getElementById(\"kakao-map\")\r\n      if (!container) {\r\n        console.error(\"ì¹´ì¹´ì˜¤ë§µ ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\")\r\n        return\r\n      }\r\n\r\n      const options = {\r\n        center: new window.kakao.maps.LatLng(position.lat, position.lng),\r\n        level: 3,\r\n      }\r\n\r\n      mapRef.current = new window.kakao.maps.Map(container, options)\r\n\r\n      // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€\r\n      addCurrentLocationMarker()\r\n\r\n      setIsMapLoaded(true)\r\n    }\r\n\r\n    loadKakaoMap()\r\n      .then(() => {\r\n        window.kakao.maps.load(initializeMap)\r\n      })\r\n      .catch(err => {\r\n        console.error(\"âŒ Kakao Maps SDK ë¡œë”© ì‹¤íŒ¨:\", err)\r\n      })\r\n\r\n    return () => {\r\n      const script = document.getElementById(\"kakao-map-sdk-script\")\r\n      if (script) script.remove()\r\n    }\r\n  }, [position, isMapLoaded, kakaoApiKey])\r\n\r\n  // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ í•¨ìˆ˜\r\n  const addCurrentLocationMarker = () => {\r\n    if (!mapRef.current || !position) return\r\n\r\n    // ê¸°ì¡´ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì œê±°\r\n    if (currentLocationMarkerRef.current) {\r\n      currentLocationMarkerRef.current.setMap(null)\r\n    }\r\n\r\n    // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ìƒì„± (íŒŒë€ìƒ‰ ì›í˜• ë§ˆì»¤)\r\n    const currentLocationMarker = new window.kakao.maps.Marker({\r\n      position: new window.kakao.maps.LatLng(position.lat, position.lng),\r\n      map: mapRef.current,\r\n    })\r\n\r\n    // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ìŠ¤íƒ€ì¼ ì„¤ì •\r\n    const currentLocationImage = new window.kakao.maps.MarkerImage(\r\n      \"data:image/svg+xml;base64,\" +\r\n        btoa(`\r\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <circle cx=\"16\" cy=\"16\" r=\"14\" fill=\"#d1d5db\" stroke=\"white\" stroke-width=\"3\"/>\r\n          <circle cx=\"16\" cy=\"16\" r=\"8\" fill=\"white\"/>\r\n          <circle cx=\"16\" cy=\"16\" r=\"4\" fill=\"#374151\"/>\r\n        </svg>\r\n      `),\r\n      new window.kakao.maps.Size(32, 32)\r\n    )\r\n\r\n    currentLocationMarker.setImage(currentLocationImage)\r\n    currentLocationMarkerRef.current = currentLocationMarker\r\n\r\n    // í˜„ì¬ ìœ„ì¹˜ ì¸í¬ìœˆë„ìš° ì¶”ê°€\r\n    const infowindow = new window.kakao.maps.InfoWindow({\r\n      content:\r\n        '<div style=\"padding:8px 12px;font-size:14px;font-weight:600;background:#d1d5db;color:#374151;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);\">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>',\r\n    })\r\n\r\n    window.kakao.maps.event.addListener(\r\n      currentLocationMarker,\r\n      \"click\",\r\n      function () {\r\n        infowindow.open(mapRef.current, currentLocationMarker)\r\n      }\r\n    )\r\n  }\r\n\r\n  // í—¬ìŠ¤ì¥ ë§ˆì»¤ ì¶”ê°€ í•¨ìˆ˜\r\n  const addGymMarkers = () => {\r\n    if (!mapRef.current || !gyms.length) return\r\n\r\n    // ê¸°ì¡´ í—¬ìŠ¤ì¥ ë§ˆì»¤ë“¤ ì œê±°\r\n    gymMarkersRef.current.forEach(marker => {\r\n      marker.setMap(null)\r\n    })\r\n    gymMarkersRef.current = []\r\n\r\n    // í—¬ìŠ¤ì¥ ë§ˆì»¤ë“¤ ì¶”ê°€\r\n    gyms.forEach((gym, index) => {\r\n      const marker = new window.kakao.maps.Marker({\r\n        position: new window.kakao.maps.LatLng(gym.latitude, gym.longitude),\r\n        map: mapRef.current,\r\n      })\r\n\r\n      // í—¬ìŠ¤ì¥ ë§ˆì»¤ ìŠ¤íƒ€ì¼ ì„¤ì • (ë¹¨ê°„ìƒ‰ í•€)\r\n      const gymImage = new window.kakao.maps.MarkerImage(\r\n        \"data:image/svg+xml;base64,\" +\r\n          btoa(`\r\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\" fill=\"#EA4335\"/>\r\n            <circle cx=\"12\" cy=\"9\" r=\"2.5\" fill=\"white\"/>\r\n          </svg>\r\n        `),\r\n        new window.kakao.maps.Size(24, 24)\r\n      )\r\n\r\n      marker.setImage(gymImage)\r\n\r\n      // í—¬ìŠ¤ì¥ ì¸í¬ìœˆë„ìš° ìƒì„±\r\n      const infowindow = new window.kakao.maps.InfoWindow({\r\n        content: `\r\n          <div style=\"padding:10px;min-width:200px;\">\r\n            <h3 style=\"margin:0 0 5px 0;font-size:14px;font-weight:bold;\">${\r\n              gym.name\r\n            }</h3>\r\n            <p style=\"margin:0 0 3px 0;font-size:12px;color:#666;\">${\r\n              gym.address\r\n            }</p>\r\n            ${\r\n              gym.phone\r\n                ? `<p style=\"margin:0 0 3px 0;font-size:12px;color:#666;\">${gym.phone}</p>`\r\n                : \"\"\r\n            }\r\n            ${\r\n              gym.rating\r\n                ? `<p style=\"margin:0;font-size:12px;color:#666;\">í‰ì : ${gym.rating.toFixed(\r\n                    1\r\n                  )}</p>`\r\n                : \"\"\r\n            }\r\n          </div>\r\n        `,\r\n      })\r\n\r\n      // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸\r\n      window.kakao.maps.event.addListener(marker, \"click\", function () {\r\n        infowindow.open(mapRef.current, marker)\r\n      })\r\n\r\n      gymMarkersRef.current.push(marker)\r\n    })\r\n  }\r\n\r\n  // í—¬ìŠ¤ì¥ ëª©ë¡ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë§ˆì»¤ ì—…ë°ì´íŠ¸\r\n  useEffect(() => {\r\n    if (isMapLoaded && gyms.length > 0) {\r\n      addGymMarkers()\r\n    }\r\n  }, [gyms, isMapLoaded])\r\n\r\n  // ê²€ìƒ‰ ì²˜ë¦¬\r\n  const handleSearch = async (query: string) => {\r\n    console.log(\"ğŸ§ª ê²€ìƒ‰ ì‹œì‘:\", query)\r\n    if (!position) {\r\n      console.warn(\"âš ï¸ ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\")\r\n      return\r\n    }\r\n\r\n    setIsLoading(true)\r\n    try {\r\n      const result = await fetchGymsByKeyword(query, position)\r\n      console.log(\"ğŸ§ª API ê²°ê³¼:\", result.length, \"ê°œ\")\r\n\r\n      // ê²°ê³¼ê°€ ì´ë¯¸ Gym íƒ€ì…ì¸ì§€ í™•ì¸í•˜ê³  ë³€í™˜\r\n      const transformedGyms: Gym[] = result.map((item: any) => {\r\n        // ì´ë¯¸ Gym íƒ€ì…ì¸ ê²½ìš° (ë”ë¯¸ ë°ì´í„°)\r\n        if (item.name && item.type) {\r\n          return item\r\n        }\r\n\r\n        // ì¹´ì¹´ì˜¤ API ê²°ê³¼ì¸ ê²½ìš° ë³€í™˜\r\n        return {\r\n          id: item.id,\r\n          name: item.place_name,\r\n          type: \"í”¼íŠ¸ë‹ˆìŠ¤\",\r\n          address: item.address_name,\r\n          phone: item.phone,\r\n          latitude: parseFloat(item.y),\r\n          longitude: parseFloat(item.x),\r\n          // ì¶”ê°€ í•„ë“œë“¤ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì • (ì‹¤ì œë¡œëŠ” ë³„ë„ API í˜¸ì¶œ í•„ìš”)\r\n          rating: Math.random() * 2 + 3, // ì„ì‹œ í‰ì  (3-5)\r\n          reviewCount: Math.floor(Math.random() * 100) + 10, // ì„ì‹œ ë¦¬ë·° ìˆ˜\r\n          hasPT: Math.random() > 0.5,\r\n          hasGX: Math.random() > 0.5,\r\n          is24Hours: Math.random() > 0.7,\r\n          hasParking: Math.random() > 0.3,\r\n          hasShower: Math.random() > 0.6,\r\n          price: `${Math.floor(Math.random() * 20 + 10)}ë§Œì›`,\r\n        }\r\n      })\r\n\r\n      console.log(\"ğŸ§ª ë³€í™˜ëœ í—¬ìŠ¤ì¥ ë°ì´í„°:\", transformedGyms.length, \"ê°œ\")\r\n      setGyms(transformedGyms)\r\n    } catch (error) {\r\n      console.error(\"ğŸ§ª ê²€ìƒ‰ ì‹¤íŒ¨:\", error)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  // í•„í„° í† ê¸€\r\n  const toggleFilter = (filter: FilterOption) => {\r\n    setActiveFilters(prev =>\r\n      prev.includes(filter) ? prev.filter(f => f !== filter) : [...prev, filter]\r\n    )\r\n  }\r\n\r\n  // ì •ë ¬ ë³€ê²½\r\n  const handleSortChange = (\r\n    newSortBy: SortOption,\r\n    newDirection: SortDirection\r\n  ) => {\r\n    setSortBy(newSortBy)\r\n    setSortDirection(newDirection)\r\n  }\r\n\r\n  // í—¬ìŠ¤ì¥ í´ë¦­ ì²˜ë¦¬ - ë§µì—ì„œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™\r\n  const handleGymClick = (gym: Gym) => {\r\n    console.log(\"í—¬ìŠ¤ì¥ í´ë¦­:\", gym)\r\n\r\n    if (mapRef.current) {\r\n      // ë§µ ì¤‘ì‹¬ì„ í•´ë‹¹ í—¬ìŠ¤ì¥ ìœ„ì¹˜ë¡œ ì´ë™\r\n      const newPosition = new window.kakao.maps.LatLng(\r\n        gym.latitude,\r\n        gym.longitude\r\n      )\r\n      mapRef.current.panTo(newPosition)\r\n\r\n      // ì¤Œ ë ˆë²¨ì„ ë” ê°€ê¹ê²Œ ì„¤ì • (ë” í™•ëŒ€)\r\n      mapRef.current.setLevel(2)\r\n\r\n      // í•´ë‹¹ í—¬ìŠ¤ì¥ ë§ˆì»¤ ì°¾ê¸°\r\n      const gymMarker = gymMarkersRef.current.find(marker => {\r\n        const markerPos = marker.getPosition()\r\n        return (\r\n          markerPos.getLat() === gym.latitude &&\r\n          markerPos.getLng() === gym.longitude\r\n        )\r\n      })\r\n\r\n      // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° (ì¸í¬ìœˆë„ìš° í‘œì‹œ)\r\n      if (gymMarker) {\r\n        window.kakao.maps.event.trigger(gymMarker, \"click\")\r\n      }\r\n    }\r\n  }\r\n\r\n  // í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜\r\n  const moveToCurrentLocation = () => {\r\n    if (mapRef.current && position) {\r\n      const currentPosition = new window.kakao.maps.LatLng(\r\n        position.lat,\r\n        position.lng\r\n      )\r\n      mapRef.current.panTo(currentPosition)\r\n      mapRef.current.setLevel(3)\r\n    }\r\n  }\r\n\r\n  // í•„í„°ë§ ë° ì •ë ¬ëœ í—¬ìŠ¤ì¥ ëª©ë¡\r\n  const processedGyms = useMemo(() => {\r\n    console.log(\"ğŸ§ª í—¬ìŠ¤ì¥ ì²˜ë¦¬ ì¤‘:\", gyms.length, \"ê°œ\")\r\n    const result = processGyms(gyms, {\r\n      activeFilters,\r\n      sortBy,\r\n      sortDirection,\r\n      maxDistance,\r\n      currentPosition: position,\r\n    })\r\n    console.log(\"ğŸ§ª ì²˜ë¦¬ëœ í—¬ìŠ¤ì¥:\", result.length, \"ê°œ\")\r\n    return result\r\n  }, [gyms, activeFilters, sortBy, sortDirection, maxDistance, position])\r\n\r\n  return (\r\n    <div className={styles.page}>\r\n      <Navigation />\r\n\r\n      <header className={styles.header}>\r\n        <h1>ë‚´ ì£¼ë³€ í—¬ìŠ¤ì¥ ì°¾ê¸°</h1>\r\n      </header>\r\n\r\n      <section className={styles.searchSection}>\r\n        <SearchBar onSearch={handleSearch} />\r\n        <div className={styles.filterGroup}>\r\n          {filters.map(filter => (\r\n            <FilterTag\r\n              key={filter}\r\n              label={filter}\r\n              active={activeFilters.includes(filter)}\r\n              onClick={() => toggleFilter(filter)}\r\n            />\r\n          ))}\r\n        </div>\r\n        <div className={styles.distanceFilter}>\r\n          <label htmlFor=\"distance-range\">ê²€ìƒ‰ ë°˜ê²½: {maxDistance}km</label>\r\n          <input\r\n            id=\"distance-range\"\r\n            type=\"range\"\r\n            min=\"1\"\r\n            max=\"20\"\r\n            value={maxDistance}\r\n            onChange={e => setMaxDistance(Number(e.target.value))}\r\n            className={styles.rangeSlider}\r\n          />\r\n        </div>\r\n      </section>\r\n\r\n      <main className={styles.main}>\r\n        <div className={styles.mapListWrapper}>\r\n          <section className={styles.mapSection}>\r\n            <div className={styles.mapHeader}>\r\n              <h2>í—¬ìŠ¤ì¥ ìœ„ì¹˜</h2>\r\n              <button\r\n                onClick={moveToCurrentLocation}\r\n                className={styles.currentLocationButton}\r\n                title=\"í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™\"\r\n              >\r\n                ğŸ“ í˜„ì¬ ìœ„ì¹˜\r\n              </button>\r\n            </div>\r\n            <div id=\"kakao-map\" className={styles.map}></div>\r\n          </section>\r\n\r\n          <section className={styles.listSection}>\r\n            <div className={styles.listHeader}>\r\n              <h2>ì¶”ì²œ í—¬ìŠ¤ì¥</h2>\r\n              {isLoading && <span>ê²€ìƒ‰ ì¤‘...</span>}\r\n            </div>\r\n            <div className={styles.gymList}>\r\n              <GymList\r\n                gyms={processedGyms}\r\n                sortBy={sortBy}\r\n                sortDirection={sortDirection}\r\n                onSortChange={handleSortChange}\r\n                onGymClick={handleGymClick}\r\n              />\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </main>\r\n\r\n      <footer className={styles.footer}>\r\n        <p>&copy; 2025 ë‚´ ì£¼ë³€ í—¬ìŠ¤ì¥ ì°¾ê¸°. All rights reserved.</p>\r\n      </footer>\r\n    </div>\r\n  )\r\n}\r\n","timestamp":1759820789694}