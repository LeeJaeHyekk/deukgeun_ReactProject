{"key":"fa904434aa57d02d98b23696207e6982","result":"const { useState, useEffect  } = require('react')\r\nconst { useNavigate  } = require('react-router-dom')\r\nconst { FaEye, FaEyeSlash, FaArrowLeft  } = require('react-icons/fa')\r\nconst { authApi  } = require('@features/auth/api/authApi')\r\nimport type { LoginRequest } from '../../../shared/types'\r\nconst { validation, showToast  } = require('@frontend/shared/lib')\r\nconst { useAuthContext  } = require('@frontend/shared/contexts/AuthContext')\r\nconst { RecaptchaWidget  } = require('@frontend/shared/components/RecaptchaWidget')\r\nconst { useAuthErrorHandler  } = require('@pages/Error')\r\n\r\nconst styles = require('./LoginPage.module.css').default\r\n\r\nmodule.exports.default = function LoginPage() {\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n  const [recaptchaToken, setRecaptchaToken] = useState<string | null>(null)\r\n  const [errors, setErrors] = useState<{\r\n    email?: string\r\n    password?: string\r\n    recaptcha?: string\r\n  }>({})\r\n  const [error, setError] = useState<string>('')\r\n  const navigate = useNavigate()\r\n  const { login, isAuthenticated } = useAuthContext()\r\n  const { handleApiError, hasError, errorInfo, retry } = useAuthErrorHandler()\r\n\r\n  // ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ì ‘ê·¼ ì‹œ ë©”ì¸í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      navigate('/', { replace: true })\r\n    }\r\n  }, [isAuthenticated, navigate])\r\n\r\n  // í¼ ê²€ì¦\r\n  const validateForm = (): boolean => {\r\n    const newErrors: {\r\n      email?: string\r\n      password?: string\r\n      recaptcha?: string\r\n    } = {}\r\n\r\n    if (!validation.required(email)) {\r\n      newErrors.email = 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    } else if (!validation.email(email)) {\r\n      newErrors.email = 'ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    }\r\n\r\n    if (!validation.required(password)) {\r\n      newErrors.password = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'\r\n    } else if (!validation.password(password)) {\r\n      newErrors.password = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'\r\n    }\r\n\r\n    if (!recaptchaToken) {\r\n      newErrors.recaptcha = 'ë³´ì•ˆ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.'\r\n    }\r\n\r\n    setErrors(newErrors)\r\n    const isValid = Object.keys(newErrors).length === 0\r\n    return isValid\r\n  }\r\n\r\n  const handleLogin = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    if (!validateForm()) {\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n    setError('')\r\n\r\n    try {\r\n      const loginData: LoginRequest = {\r\n        email: email.trim().toLowerCase(),\r\n        password,\r\n        recaptchaToken: recaptchaToken!,\r\n      }\r\n\r\n      console.log('ğŸ§ª ë¡œê·¸ì¸ ë°ì´í„°:', { ...loginData, password: '***' })\r\n\r\n      const response = await authApi.login(loginData)\r\n\r\n      console.log('ğŸ§ª ë¡œê·¸ì¸ ì‘ë‹µ:', response)\r\n\r\n      if (!response || !response.user) {\r\n        console.log('ğŸ§ª ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‚¬ìš©ì ì •ë³´ ì—†ìŒ')\r\n        showToast('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error')\r\n        setLoading(false)\r\n        return\r\n      }\r\n\r\n      // AuthContextì˜ login í•¨ìˆ˜ ì‚¬ìš© (Zustand + storage ëª¨ë‘ ì—…ë°ì´íŠ¸)\r\n      console.log('ğŸ§ª AuthContext login í˜¸ì¶œ')\r\n\r\n      // ë°±ì—”ë“œ ì‘ë‹µì„ ìƒˆë¡œìš´ íƒ€ì… ì‹œìŠ¤í…œê³¼ í˜¸í™˜ë˜ë„ë¡ ë³€í™˜\r\n      const userWithToken = {\r\n        id: response.user.id,\r\n        email: response.user.email,\r\n        nickname: response.user.nickname,\r\n        accessToken: response.accessToken,\r\n        // ìƒˆë¡œìš´ íƒ€ì… ì‹œìŠ¤í…œì—ì„œ ìš”êµ¬í•˜ëŠ” í•„ë“œë“¤ì— ê¸°ë³¸ê°’ ì„¤ì •\r\n        role: 'user' as const,\r\n        isActive: true,\r\n        isEmailVerified: false,\r\n        isPhoneVerified: false,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      }\r\n      login(userWithToken, response.accessToken)\r\n\r\n      console.log('ğŸ§ª ë¡œê·¸ì¸ ì„±ê³µ!')\r\n      showToast('ë¡œê·¸ì¸ ì„±ê³µ!', 'success')\r\n\r\n      // ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ëŠ” App.tsxì˜ RedirectIfLoggedInì—ì„œ ì²˜ë¦¬\r\n    } catch (error: unknown) {\r\n      console.log('ğŸ§ª ë¡œê·¸ì¸ ì—ëŸ¬:', error)\r\n      handleApiError(error as any)\r\n      setError(errorInfo.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\r\n    } finally {\r\n      setLoading(false)\r\n      console.log('ğŸ§ª ë¡œê·¸ì¸ ì²˜ë¦¬ ì™„ë£Œ')\r\n    }\r\n  }\r\n\r\n  const handleRecaptchaChange = (token: string | null) => {\r\n    // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë”ë¯¸ í† í° ì‚¬ìš©\r\n    const finalToken = process.env.DEV\r\n      ? 'dummy-token-for-development'\r\n      : token\r\n\r\n    console.log('ğŸ§ª reCAPTCHA í† í° ë³€ê²½:', {\r\n      originalToken: token,\r\n      finalToken,\r\n    })\r\n    setRecaptchaToken(finalToken)\r\n    // reCAPTCHA ì™„ë£Œ ì‹œ í•´ë‹¹ ì—ëŸ¬ ì´ˆê¸°í™”\r\n    if (finalToken && errors.recaptcha) {\r\n      setErrors(prev => ({ ...prev, recaptcha: undefined }))\r\n    }\r\n    setError('') // ì „ì²´ ì—ëŸ¬ ë©”ì‹œì§€ë„ ì´ˆê¸°í™”\r\n  }\r\n\r\n  // ì—ëŸ¬ ìƒíƒœ í‘œì‹œ\r\n  if (hasError) {\r\n    return (\r\n      <div className={styles.pageWrapper}>\r\n        <div className={styles.loginBox}>\r\n          <div style={{ textAlign: 'center', color: '#f1f3f5' }}>\r\n            <h2>ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>\r\n            <p>{errorInfo.message}</p>\r\n            <button\r\n              onClick={retry}\r\n              style={{\r\n                padding: '10px 20px',\r\n                backgroundColor: '#4f46e5',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '8px',\r\n                cursor: 'pointer',\r\n                marginTop: '20px',\r\n              }}\r\n            >\r\n              ë‹¤ì‹œ ì‹œë„\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¼ë©´ ë¡œë”© í™”ë©´ í‘œì‹œ\r\n  if (isAuthenticated) {\r\n    return (\r\n      <div className={styles.pageWrapper}>\r\n        <div className={styles.loginBox}>\r\n          <div style={{ textAlign: 'center', color: '#f1f3f5' }}>\r\n            <p>ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì…ë‹ˆë‹¤.</p>\r\n            <p>ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™ ì¤‘...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={styles.pageWrapper}>\r\n      <div className={styles.loginBox}>\r\n        <button\r\n          onClick={() => navigate('/')}\r\n          className={styles.backButton}\r\n          aria-label=\"ë’¤ë¡œ ê°€ê¸°\"\r\n        >\r\n          <FaArrowLeft />\r\n        </button>\r\n\r\n        <h1 className={styles.logo}>ë“ê·¼ ë“ê·¼</h1>\r\n\r\n        <form\r\n          onSubmit={e => {\r\n            e.preventDefault()\r\n            handleLogin(e)\r\n          }}\r\n        >\r\n          <div className={styles.inputGroup}>\r\n            <input\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={e => {\r\n                setEmail(e.target.value)\r\n                if (errors.email) {\r\n                  setErrors(prev => ({ ...prev, email: undefined }))\r\n                }\r\n              }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' && !loading) {\r\n                  e.preventDefault()\r\n                  handleLogin(e)\r\n                }\r\n              }}\r\n              placeholder=\"ì´ë©”ì¼\"\r\n              className={`${styles.input} ${\r\n                errors.email ? styles.inputError : ''\r\n              }`}\r\n              autoComplete=\"email\"\r\n              aria-describedby={errors.email ? 'email-error' : undefined}\r\n            />\r\n            {errors.email && (\r\n              <span id=\"email-error\" className={styles.errorText}>\r\n                {errors.email}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          <div className={styles.inputGroup}>\r\n            <div className={styles.passwordWrapper}>\r\n              <input\r\n                type={showPassword ? 'text' : 'password'}\r\n                value={password}\r\n                onChange={e => {\r\n                  setPassword(e.target.value)\r\n                  if (errors.password) {\r\n                    setErrors(prev => ({ ...prev, password: undefined }))\r\n                  }\r\n                }}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter' && !loading) {\r\n                    e.preventDefault()\r\n                    handleLogin(e)\r\n                  }\r\n                }}\r\n                placeholder=\"ë¹„ë°€ë²ˆí˜¸\"\r\n                className={`${styles.passwordInput} ${\r\n                  errors.password ? styles.inputError : ''\r\n                }`}\r\n                autoComplete=\"current-password\"\r\n                aria-describedby={\r\n                  errors.password ? 'password-error' : undefined\r\n                }\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowPassword(!showPassword)}\r\n                className={styles.eyeButton}\r\n                aria-label={showPassword ? 'ë¹„ë°€ë²ˆí˜¸ ìˆ¨ê¸°ê¸°' : 'ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°'}\r\n              >\r\n                {showPassword ? <FaEyeSlash /> : <FaEye />}\r\n              </button>\r\n            </div>\r\n            {errors.password && (\r\n              <span id=\"password-error\" className={styles.errorText}>\r\n                {errors.password}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          <div className={styles.recaptchaContainer}>\r\n            <RecaptchaWidget\r\n              onChange={handleRecaptchaChange}\r\n              className={styles.recaptchaWidget}\r\n              aria-describedby={\r\n                errors.recaptcha ? 'recaptcha-error' : undefined\r\n              }\r\n            />\r\n            {errors.recaptcha && (\r\n              <span id=\"recaptcha-error\" className={styles.errorText}>\r\n                {errors.recaptcha}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className={styles.loginButton}\r\n            disabled={loading}\r\n            aria-describedby={loading ? 'loading-description' : undefined}\r\n          >\r\n            {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}\r\n          </button>\r\n          {loading && (\r\n            <span id=\"loading-description\" className=\"sr-only\">\r\n              ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.\r\n            </span>\r\n          )}\r\n        </form>\r\n\r\n        <div className={styles.divider}>ë˜ëŠ”</div>\r\n\r\n        <div className={styles.socialWrapper}>\r\n          <button\r\n            type=\"button\"\r\n            className={styles.kakaoBtn}\r\n            disabled={loading}\r\n            onClick={() => showToast('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info')}\r\n          >\r\n            ğŸŸ¡ ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className={styles.googleBtn}\r\n            disabled={loading}\r\n            onClick={() => showToast('Google ë¡œê·¸ì¸ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info')}\r\n          >\r\n            ğŸ”µ Googleë¡œ ë¡œê·¸ì¸\r\n          </button>\r\n        </div>\r\n\r\n        <div className={styles.linkRow}>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => navigate('/signup')}\r\n            className={styles.linkBtn}\r\n            disabled={loading}\r\n          >\r\n            íšŒì›ê°€ì…\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => navigate('/find-id')}\r\n            className={styles.linkBtn}\r\n            disabled={loading}\r\n          >\r\n            ì•„ì´ë”” ì°¾ê¸°\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => navigate('/find-password')}\r\n            className={styles.linkBtn}\r\n            disabled={loading}\r\n          >\r\n            ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°\r\n          </button>\r\n        </div>\r\n\r\n        <div className={styles.recaptcha}>\r\n          <p className={styles.recaptchaText}>\r\n            ì´ ì‚¬ì´íŠ¸ëŠ” reCAPTCHA ë° Google ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ê³¼ ì„œë¹„ìŠ¤ ì•½ê´€ì˜\r\n            ì ìš©ì„ ë°›ìŠµë‹ˆë‹¤.\r\n          </p>\r\n        </div>\r\n        {error && <p className={styles.errorMessage}>{error}</p>}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","timestamp":1759907919220}