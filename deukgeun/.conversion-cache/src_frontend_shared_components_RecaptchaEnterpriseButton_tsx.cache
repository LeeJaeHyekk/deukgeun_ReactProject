{"key":"e407ab28e9e78ba711a51cc73dfea084","result":"// Browser API polyfills for Node.js environment\nif (typeof window === 'undefined') {\n  global.window = global.window || {}\n  global.document = global.document || {}\n  global.localStorage = global.localStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.sessionStorage = global.sessionStorage || {\n    getItem: () => null,\n    setItem: () => {},\n    removeItem: () => {},\n    clear: () => {}\n  }\n  global.File = global.File || class File {}\n  global.StorageEvent = global.StorageEvent || class StorageEvent {}\n  global.requestAnimationFrame = global.requestAnimationFrame || (cb => setTimeout(cb, 16))\n}\n\nimport React, { useEffect, useState } from 'react'\r\n\r\ninterface RecaptchaEnterpriseButtonProps {\r\n  action: string\r\n  onSuccess: (token: string) => void\r\n  onError: (error: any) => void\r\n  children: React.ReactNode\r\n  className?: string\r\n  disabled?: boolean\r\n  loading?: boolean\r\n}\r\n\r\n// Remove global declaration to avoid conflict\r\n\r\nexport const RecaptchaEnterpriseButton: React.FC<RecaptchaEnterpriseButtonProps> = ({\r\n  action,\r\n  onSuccess,\r\n  onError,\r\n  children,\r\n  className = '',\r\n  disabled = false,\r\n  loading = false\r\n}) => {\r\n  const [isRecaptchaLoaded, setIsRecaptchaLoaded] = useState(false)\r\n  const [isExecuting, setIsExecuting] = useState(false)\r\n\r\n  useEffect(() => {\r\n    const loadRecaptcha = () => {\r\n      if (window.grecaptcha && window.grecaptcha.enterprise) {\r\n        window.grecaptcha.enterprise.ready(() => {\r\n          console.log('reCAPTCHA Enterprise ë¡œë“œë¨')\r\n          setIsRecaptchaLoaded(true)\r\n        })\r\n      } else {\r\n        console.warn('reCAPTCHA Enterpriseê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')\r\n      }\r\n    }\r\n\r\n    if (document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', loadRecaptcha)\r\n    } else {\r\n      loadRecaptcha()\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('DOMContentLoaded', loadRecaptcha)\r\n    }\r\n  }, [])\r\n\r\n  const handleClick = async (e: React.MouseEvent) => {\r\n    e.preventDefault()\r\n\r\n    if (disabled || loading || isExecuting) {\r\n      return\r\n    }\r\n\r\n    if (!isRecaptchaLoaded) {\r\n      onError(new Error('reCAPTCHA Enterpriseê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'))\r\n      return\r\n    }\r\n\r\n    try {\r\n      setIsExecuting(true)\r\n\r\n      const siteKey = process.env.VITE_RECAPTCHA_SITE_KEY\r\n      if (!siteKey) {\r\n        throw new Error('reCAPTCHA ì‚¬ì´íŠ¸ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')\r\n      }\r\n\r\n      const token = await (window.grecaptcha as any).enterprise.execute(siteKey, { action })\r\n      \r\n      if (!token) {\r\n        throw new Error('reCAPTCHA í† í° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\r\n      }\r\n\r\n      onSuccess(token)\r\n    } catch (error) {\r\n      console.error('reCAPTCHA Enterprise ì‹¤í–‰ ì˜¤ë¥˜:', error)\r\n      onError(error)\r\n    } finally {\r\n      setIsExecuting(false)\r\n    }\r\n  }\r\n\r\n  const isDisabled = disabled || loading || isExecuting || !isRecaptchaLoaded\r\n\r\n  return (\r\n    <button\r\n      onClick={handleClick}\r\n      disabled={isDisabled}\r\n      className={`recaptcha-enterprise-button ${className} ${\r\n        isDisabled ? 'disabled' : ''\r\n      } ${isExecuting ? 'executing' : ''}`}\r\n      data-testid=\"recaptcha-enterprise-button\"\r\n    >\r\n      {isExecuting ? (\r\n        <span className=\"loading-spinner\">ğŸ”„</span>\r\n      ) : (\r\n        children\r\n      )}\r\n    </button>\r\n  )\r\n}\r\n\r\n/**\r\n * reCAPTCHA Enterprise í›…\r\n * ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í›…\r\n */\r\nexport const useRecaptchaEnterprise = () => {\r\n  const [isLoaded, setIsLoaded] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    const checkRecaptcha = () => {\r\n      if (window.grecaptcha && window.grecaptcha.enterprise) {\r\n        window.grecaptcha.enterprise.ready(() => {\r\n          setIsLoaded(true)\r\n          setIsLoading(false)\r\n        })\r\n      } else {\r\n        setIsLoading(false)\r\n      }\r\n    }\r\n\r\n    if (document.readyState === 'loading') {\r\n      document.addEventListener('DOMContentLoaded', checkRecaptcha)\r\n    } else {\r\n      checkRecaptcha()\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('DOMContentLoaded', checkRecaptcha)\r\n    }\r\n  }, [])\r\n\r\n  const executeRecaptcha = async (action: string): Promise<string> => {\r\n    if (!isLoaded) {\r\n      throw new Error('reCAPTCHA Enterpriseê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')\r\n    }\r\n\r\n    const siteKey = process.env.VITE_RECAPTCHA_SITE_KEY\r\n    if (!siteKey) {\r\n      throw new Error('reCAPTCHA ì‚¬ì´íŠ¸ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')\r\n    }\r\n\r\n    return await (window.grecaptcha as any).enterprise.execute(siteKey, { action })\r\n  }\r\n\r\n  return {\r\n    isLoaded,\r\n    isLoading,\r\n    executeRecaptcha\r\n  }\r\n}\r\n\r\n/**\r\n * reCAPTCHA Enterprise ìŠ¤í¬ë¦½íŠ¸ ë¡œë”\r\n * HTML headì— reCAPTCHA Enterprise ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€\r\n */\r\nexport const RecaptchaEnterpriseScript: React.FC = () => {\r\n  useEffect(() => {\r\n    const siteKey = process.env.VITE_RECAPTCHA_SITE_KEY\r\n    if (!siteKey) {\r\n      console.error('reCAPTCHA ì‚¬ì´íŠ¸ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')\r\n      return\r\n    }\r\n\r\n    // ì´ë¯¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸\r\n    if (document.querySelector('script[src*=\"recaptcha/enterprise.js\"]')) {\r\n      return\r\n    }\r\n\r\n    const script = document.createElement('script')\r\n    script.src = `https://www.google.com/recaptcha/enterprise.js?render=${siteKey}`\r\n    script.async = true\r\n    script.defer = true\r\n\r\n    script.onload = () => {\r\n      console.log('reCAPTCHA Enterprise ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ')\r\n    }\r\n\r\n    script.onerror = () => {\r\n      console.error('reCAPTCHA Enterprise ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨')\r\n    }\r\n\r\n    document.head.appendChild(script)\r\n\r\n    return () => {\r\n      // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì œê±°í•˜ì§€ ì•ŠìŒ (ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ)\r\n    }\r\n  }, [])\r\n\r\n  return null\r\n}\r\n","timestamp":1759907919234}