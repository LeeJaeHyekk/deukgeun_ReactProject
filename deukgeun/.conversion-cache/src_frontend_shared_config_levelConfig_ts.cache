{"key":"91c8fddd28cab492465e7a9e92e55d5d","result":"// ============================================================================\r\n// Level API Configuration\r\n// ============================================================================\r\n\r\nexport const LEVEL_CONFIG = {\r\n  // API 활성화 여부\r\n  ENABLED: process.env.VITE_ENABLE_LEVEL_API === 'true',\r\n  \r\n  // API 호출 제한\r\n  FETCH_COOLDOWN: 30000, // 30초\r\n  MAX_RETRY_ATTEMPTS: 2,\r\n  MAX_CONSECUTIVE_ERRORS: 3,\r\n  \r\n  // 기본값\r\n  DEFAULT_LEVEL: 1,\r\n  DEFAULT_EXP: 0,\r\n  DEFAULT_EXP_TO_NEXT: 100,\r\n  \r\n  // 오류 처리\r\n  AUTO_DISABLE_ON_403: true,\r\n  SUPPRESS_ERROR_LOGS: true,\r\n  \r\n  // 기능 플래그\r\n  FEATURES: {\r\n    EXP_GRANTING: true,\r\n    REWARDS: true,\r\n    LEADERBOARD: false,\r\n    ACHIEVEMENTS: false,\r\n  }\r\n} as const\r\n\r\n// ============================================================================\r\n// Level API 상태 관리\r\n// ============================================================================\r\n\r\nclass LevelApiState {\r\n  private isEnabled: boolean = LEVEL_CONFIG.ENABLED\r\n  private consecutiveErrors: number = 0\r\n  private lastErrorTime: number = 0\r\n\r\n  isApiEnabled(): boolean {\r\n    return this.isEnabled\r\n  }\r\n\r\n  disableApi(): void {\r\n    this.isEnabled = false\r\n    console.log(\"레벨 API 비활성화됨\")\r\n  }\r\n\r\n  enableApi(): void {\r\n    this.isEnabled = true\r\n    this.consecutiveErrors = 0\r\n    console.log(\"레벨 API 활성화됨\")\r\n  }\r\n\r\n  recordError(): void {\r\n    this.consecutiveErrors++\r\n    this.lastErrorTime = Date.now()\r\n    \r\n    if (this.consecutiveErrors >= LEVEL_CONFIG.MAX_CONSECUTIVE_ERRORS) {\r\n      console.warn(\"연속 오류로 인한 레벨 API 비활성화\")\r\n      this.disableApi()\r\n    }\r\n  }\r\n\r\n  recordSuccess(): void {\r\n    this.consecutiveErrors = 0\r\n  }\r\n\r\n  getConsecutiveErrors(): number {\r\n    return this.consecutiveErrors\r\n  }\r\n\r\n  shouldSkipApiCall(): boolean {\r\n    if (!this.isEnabled) return true\r\n    if (this.consecutiveErrors >= LEVEL_CONFIG.MAX_CONSECUTIVE_ERRORS) return true\r\n    return false\r\n  }\r\n}\r\n\r\nexport const levelApiState = new LevelApiState()\r\n","timestamp":1759820789742}