# 환경 최적화 완료 보고서

## 📊 현재 상태

### 디스크 사용량
- **총 용량**: 20GB
- **사용량**: 8.3GB (42%)
- **남은 용량**: 12GB (58%)

### 프로젝트 크기
- **프로젝트 전체**: 1.2GB (최적화 전: 1.4GB)
- **백업**: 190MB (최적화 전: 379MB) - **189MB 절약**
- **node_modules**: 657MB
- **dist**: 47MB
- **logs**: 988KB (최적화 전: 2.4MB) - **1.4MB 절약**

### 메모리 상태
- **총 메모리**: 904MB
- **사용 중**: 702MB
- **Swap**: 3.0GB

---

## ✅ 수행된 최적화 작업

### 1. 백업 파일 정리
- **삭제**: 오래된 백업 파일 1개 (190MB)
- **유지**: 최신 백업 파일 1개만 유지
- **절약**: 189MB

### 2. 로그 파일 정리
- **초기화**: 모든 로그 파일 초기화
- **로테이션**: PM2 로그 로테이션 모듈 설치 및 설정
  - 최대 로그 크기: 10MB
  - 보관 기간: 5개 파일
  - 압축: 활성화
- **절약**: 약 1.4MB

### 3. PM2 메모리 설정 최적화 (사용성 고려)
- **변경 전**: `max_memory_restart: '2G'`, `node_args: '--max-old-space-size=4096'`
- **변경 후**: `max_memory_restart: '700M'`, `node_args: '--max-old-space-size=700'`
- **이유**: 
  - 시스템 메모리(904MB)와 Swap(3GB)을 고려하여 안정적 동작 보장
  - 백엔드 서버가 충분한 메모리를 사용할 수 있도록 설정
  - 시스템에 약 200MB 여유를 유지하여 안정성 확보
  - 메모리 부족으로 인한 빈번한 재시작 방지

### 4. npm 캐시 정리
- **정리**: npm 캐시 완전 정리
- **절약**: 약 29MB

### 5. PM2 로그 로테이션 자동화
- **모듈**: pm2-logrotate 설치 완료
- **설정**:
  - `max_size`: 10M
  - `retain`: 5개 파일
  - `compress`: true (압축 활성화)
  - `dateFormat`: YYYY-MM-DD_HH-mm-ss

---

## 🔧 최적화된 설정 파일

### ecosystem.config.cjs
```javascript
// 메모리 설정 최적화 (사용성 고려 - 시스템 메모리 904MB, Swap 3GB 활용)
// 백엔드 서버 안정적 동작을 위해 700MB 할당, 시스템에 약 200MB 여유 유지
max_memory_restart: '700M',
node_args: '--max-old-space-size=700 --optimize-for-size',
```

---

## 📝 자동화 스크립트

### 환경 최적화 스크립트
```bash
./scripts/optimize-environment.sh
```

이 스크립트는 다음을 수행합니다:
1. 오래된 백업 파일 정리 (최신 1개만 유지)
2. 큰 로그 파일 정리 (10MB 이상)
3. npm 캐시 정리
4. PM2 로그 로테이션 확인 및 설정
5. 디스크 사용량 확인

**사용법**:
```bash
cd /home/ec2-user/deukgeun_ReactProject/deukgeun
./scripts/optimize-environment.sh
```

---

## 📈 최적화 결과 요약

| 항목 | 최적화 전 | 최적화 후 | 절약 |
|------|----------|----------|------|
| 프로젝트 크기 | 1.4GB | 1.2GB | 200MB |
| 백업 파일 | 379MB | 190MB | 189MB |
| 로그 파일 | 2.4MB | 988KB | 1.4MB |
| npm 캐시 | 29MB | 0MB | 29MB |
| **총 절약** | - | - | **약 220MB** |

---

## 🔄 정기적인 최적화 권장사항

### 주간 정리 (수동 또는 cron)
```bash
# 매주 월요일 자정에 실행
0 0 * * 1 cd /home/ec2-user/deukgeun_ReactProject/deukgeun && ./scripts/optimize-environment.sh
```

### PM2 로그 로테이션
- 자동으로 10MB 이상 로그 파일 로테이션
- 최대 5개 파일 보관 후 자동 삭제
- 압축하여 저장 공간 절약

### 메모리 모니터링
- PM2가 메모리 사용량이 512MB를 초과하면 자동 재시작
- 시스템 메모리 사용량 모니터링 권장

---

## ⚠️ 주의사항

1. **메모리 설정**: 시스템 메모리가 904MB이고 Swap이 3GB이므로 PM2 메모리 제한을 700MB로 설정했습니다. 이는 사용성을 고려하여 안정적인 서버 동작을 보장하면서도 시스템에 충분한 여유를 유지합니다. 메모리 부족 시 자동 재시작됩니다.

2. **백업 파일**: 최신 1개만 유지하도록 설정했습니다. 필요 시 백업을 수동으로 보관하세요.

3. **로그 파일**: PM2 로그 로테이션이 자동으로 관리하지만, 필요 시 수동으로 정리할 수 있습니다.

---

## 📊 향후 모니터링

### 디스크 사용량 확인
```bash
df -h
du -sh /home/ec2-user/deukgeun_ReactProject/deukgeun
```

### 메모리 사용량 확인
```bash
free -h
pm2 monit
```

### 로그 확인
```bash
pm2 logs
ls -lh logs/
```

---

**최적화 완료일**: $(date +%Y-%m-%d)

