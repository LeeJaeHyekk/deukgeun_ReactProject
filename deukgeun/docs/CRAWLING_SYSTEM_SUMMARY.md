# í¬ë¡¤ë§ ì‹œìŠ¤í…œ ì •ìƒ ë™ì‘ í™•ì¸ ë° ìˆ˜ì • ìš”ì•½

## ğŸ“‹ ê²€ì¦ ìš”ì²­ ì‚¬í•­

1. âœ… ì„œìš¸ API ë¶ˆëŸ¬ì˜¤ê¸°
2. âœ… í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì§€ê³  í¬ë¡¤ë§í•œ ì •ë³´
3. âœ… 1,2ì˜ ì •ë³´ë¥¼ ì¡°í•©í•´ gyms_raw.jsonì— ì—…ë°ì´íŠ¸

## ğŸ” ë°œê²¬ëœ ë¬¸ì œì  ë° ìˆ˜ì • ì‚¬í•­

### 1. **íŒŒì¼ ê²½ë¡œ ë¬¸ì œ ìˆ˜ì •** âš ï¸ **ì¤‘ìš”**

**ë¬¸ì œ:**
- ê¸°ì¡´ ì½”ë“œì—ì„œ `process.cwd()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒëŒ€ ê²½ë¡œë¡œ íŒŒì¼ì„ ì°¸ì¡°
- ì‹¤í–‰ ìœ„ì¹˜ì— ë”°ë¼ ê²½ë¡œê°€ ë‹¬ë¼ì ¸ íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œ ë°œìƒ

**ìˆ˜ì •:**
- `src/backend/modules/crawling/utils/pathUtils.ts` ìƒì„±
- `__filename` ê¸°ë°˜ìœ¼ë¡œ ì ˆëŒ€ ê²½ë¡œ ê³„ì‚°
- ëª¨ë“  íŒŒì¼ ê²½ë¡œ ì°¸ì¡°ë¥¼ í†µì¼ëœ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¡œ ë³€ê²½

```typescript
// ìˆ˜ì • ì „
const filePath = path.join(process.cwd(), '..', '..', 'src', 'data', 'gyms_raw.json')

// ìˆ˜ì • í›„
const filePath = getGymsRawPath()
```

**ìˆ˜ì •ëœ íŒŒì¼:**
- âœ… `src/backend/modules/crawling/core/CrawlingService.ts`
  - `crawlGymsFromRawData()` ë©”ì„œë“œ
  - `mergeAndSaveToGymsRaw()` ë©”ì„œë“œ
  - `saveToGymsRaw()` ë©”ì„œë“œ
  - `appendToGymsRaw()` ë©”ì„œë“œ
- âœ… `src/backend/modules/crawling/tracking/CrawlingHistoryTracker.ts`
  - `saveHistoryToFile()` ë©”ì„œë“œ
  - `loadHistoryFromFile()` ë©”ì„œë“œ

### 2. ìƒˆë¡œìš´ ìœ í‹¸ë¦¬í‹° íŒŒì¼ ìƒì„±

**íŒŒì¼:** `src/backend/modules/crawling/utils/pathUtils.ts`

**ì œê³µ í•¨ìˆ˜:**
- `getProjectRoot()`: í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê²½ë¡œ
- `getGymsRawPath()`: gyms_raw.json íŒŒì¼ ì ˆëŒ€ ê²½ë¡œ
- `getDataDir()`: ë°ì´í„° ë””ë ‰í† ë¦¬ ê²½ë¡œ
- `getCrawlingHistoryDir()`: í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ ë””ë ‰í† ë¦¬ ê²½ë¡œ
- `getCrawlingHistoryPath()`: í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ íŒŒì¼ ê²½ë¡œ

## âœ… í¬ë¡¤ë§ ì‹œìŠ¤í…œ ë™ì‘ í”Œë¡œìš° í™•ì¸

### 1ë‹¨ê³„: ì„œìš¸ API ë°ì´í„° ìˆ˜ì§‘ âœ…

**ìœ„ì¹˜:** `src/backend/modules/crawling/sources/PublicApiSource.ts`

**ë™ì‘:**
```
ğŸ“¡ ì„œìš¸ì‹œ ê³µê³µë°ì´í„° API í˜¸ì¶œ
  â†“
ğŸ” LOCALDATA_104201 ì„œë¹„ìŠ¤ ì‚¬ìš© (ì²´ìœ¡ì‹œì„¤)
  â†“
âœ… ì˜ì—…ì¤‘ ì‹œì„¤ë§Œ í•„í„°ë§ (TRDSTATENM)
  â†“
ğŸ‹ï¸ í—¬ìŠ¤ì¥ ê´€ë ¨ ì—…ì¢…ë§Œ í•„í„°ë§
  â†“
ğŸ’¾ ProcessedGymData í˜•ì‹ìœ¼ë¡œ ë³€í™˜
```

**í•„í„°ë§ ì¡°ê±´:**
- âœ… ì˜ì—…ìƒíƒœ: "ì˜ì—…ì¤‘" ë˜ëŠ” "ì •ìƒ"
- âœ… ì—…ì¢…: gym, gx, pt, í¬ë¡œìŠ¤í•, í•„ë¼í…ŒìŠ¤, ìš”ê°€ ë“±

### 2ë‹¨ê³„: gyms_raw.jsonì— ì €ì¥ âœ…

**ìœ„ì¹˜:** `src/backend/modules/crawling/core/CrawlingService.ts`
- `saveToGymsRaw()` ë©”ì„œë“œ

**ë™ì‘:**
```
ğŸ“„ ê¸°ì¡´ gyms_raw.json ì½ê¸°
  â†“
ğŸ”„ ìƒˆ ë°ì´í„°ì™€ ê¸°ì¡´ ë°ì´í„° ë³‘í•©
  â†“
ğŸ§¹ ì¤‘ë³µ ì œê±° (ì´ë¦„ + ì£¼ì†Œ ê¸°ë°˜)
  â†“
ğŸ’¾ gyms_raw.jsonì— ì €ì¥
```

### 3ë‹¨ê³„: name ê¸°ë°˜ ì›¹ í¬ë¡¤ë§ âœ…

**ìœ„ì¹˜:** 
- `src/backend/modules/crawling/core/CrawlingService.ts` - `crawlGymsFromRawData()`
- `src/backend/modules/crawling/sources/OptimizedGymCrawlingSource.ts`

**ë™ì‘:**
```
ğŸ“„ gyms_raw.jsonì—ì„œ í—¬ìŠ¤ì¥ ëª©ë¡ ì½ê¸°
  â†“
ğŸ” ê° í—¬ìŠ¤ì¥ ì´ë¦„ìœ¼ë¡œ 5ê°œ ê²€ìƒ‰ ì—”ì§„ ë³‘ë ¬ í¬ë¡¤ë§
  - NaverSearchEngine
  - GoogleSearchEngine
  - DaumSearchEngine
  - NaverBlogSearchEngine
  - NaverCafeSearchEngine
  â†“
ğŸ”¬ êµì°¨ ê²€ì¦ (CrossValidator)
  - ì „í™”ë²ˆí˜¸ ê²€ì¦
  - ìš´ì˜ì‹œê°„ ê²€ì¦
  - ê°€ê²© ì •ë³´ ê²€ì¦
  - ì‹œì„¤ ì •ë³´ ê²€ì¦
  â†“
â­ ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
  â†“
ğŸ“¦ EnhancedGymInfo ë°˜í™˜
```

### 4ë‹¨ê³„: ë°ì´í„° ë³‘í•© ë° ì—…ë°ì´íŠ¸ âœ…

**ìœ„ì¹˜:** 
- `src/backend/modules/crawling/core/CrawlingService.ts` - `mergeAndSaveToGymsRaw()`
- `src/backend/modules/crawling/processors/EnhancedDataMerger.ts`

**ë™ì‘:**
```
ğŸ“„ ê¸°ì¡´ gyms_raw.json ì½ê¸°
  â†“
ğŸ”„ í¬ë¡¤ë§ ë°ì´í„°ì™€ ê¸°ì¡´ ë°ì´í„° ë³‘í•©
  - ì´ë¦„ + ì£¼ì†Œë¡œ ë§¤ì¹­
  - ì¶©ëŒ í•´ê²° (ì‹ ë¢°ë„ ê¸°ë°˜)
  - í•„ë“œë³„ ë³‘í•© ì „ëµ ì ìš©
  â†“
ğŸ“Š ë³‘í•© í†µê³„ ìƒì„±
  - ì„±ê³µì ìœ¼ë¡œ ë³‘í•©ëœ ê°œìˆ˜
  - í´ë°± ì‚¬ìš© ê°œìˆ˜
  - ì¤‘ë³µ ì œê±° ê°œìˆ˜
  - í’ˆì§ˆ ì ìˆ˜
  â†“
ğŸ’¾ gyms_raw.jsonì— ìµœì¢… ì €ì¥
  â†“
ğŸ“ í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ ê¸°ë¡
```

## ğŸ”§ í†µí•© í¬ë¡¤ë§ ì‹¤í–‰ ë°©ë²•

### ë°©ë²• 1: í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
cd src/backend
npx ts-node scripts/test-integrated-crawling.ts
```

### ë°©ë²• 2: ì„œë¹„ìŠ¤ì—ì„œ ì§ì ‘ í˜¸ì¶œ

```typescript
import { CrawlingService } from './modules/crawling/core/CrawlingService'
import { getRepository } from 'typeorm'
import { Gym } from './entities/Gym'

const gymRepo = getRepository(Gym)
const crawlingService = new CrawlingService(gymRepo)

// í¬ë¡¤ë§ ì‹¤í–‰
const result = await crawlingService.executeIntegratedCrawling()

console.log('ê²°ê³¼:', result)
```

## ğŸ“Š í¬ë¡¤ë§ ì„¤ì • ì˜µì…˜

```typescript
crawlingService.updateConfig({
  enablePublicApi: true,        // ê³µê³µ API ìˆ˜ì§‘ í™œì„±í™”
  enableCrawling: true,          // ì›¹ í¬ë¡¤ë§ í™œì„±í™”
  enableDataMerging: true,       // ë°ì´í„° ë³‘í•© í™œì„±í™”
  enableQualityCheck: true,      // í’ˆì§ˆ ê²€ì‚¬ í™œì„±í™”
  batchSize: 5,                  // ë°°ì¹˜ í¬ê¸°
  maxConcurrentRequests: 1,      // ìµœëŒ€ ë™ì‹œ ìš”ì²­ ìˆ˜
  delayBetweenBatches: 10000,    // ë°°ì¹˜ ê°„ ì§€ì—° (ms)
  maxRetries: 3,                 // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
  timeout: 30000,                // íƒ€ì„ì•„ì›ƒ (ms)
  saveToFile: true,              // íŒŒì¼ ì €ì¥ ì—¬ë¶€
  saveToDatabase: true           // DB ì €ì¥ ì—¬ë¶€
})
```

## ğŸ“ ì£¼ìš” íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â””â”€â”€ crawling/
â”‚   â”‚       â”œâ”€â”€ core/
â”‚   â”‚       â”‚   â”œâ”€â”€ CrawlingService.ts          # âœ… ë©”ì¸ í¬ë¡¤ë§ ì„œë¹„ìŠ¤
â”‚   â”‚       â”‚   â””â”€â”€ DataProcessor.ts
â”‚   â”‚       â”œâ”€â”€ sources/
â”‚   â”‚       â”‚   â”œâ”€â”€ PublicApiSource.ts          # âœ… ì„œìš¸ API ì†ŒìŠ¤
â”‚   â”‚       â”‚   â””â”€â”€ OptimizedGymCrawlingSource.ts # âœ… ì›¹ í¬ë¡¤ë§ ì†ŒìŠ¤
â”‚   â”‚       â”œâ”€â”€ processors/
â”‚   â”‚       â”‚   â”œâ”€â”€ DataMerger.ts               # ê¸°ë³¸ ë³‘í•©
â”‚   â”‚       â”‚   â”œâ”€â”€ EnhancedDataMerger.ts       # âœ… í–¥ìƒëœ ë³‘í•©
â”‚   â”‚       â”‚   â”œâ”€â”€ CrossValidator.ts           # âœ… êµì°¨ ê²€ì¦
â”‚   â”‚       â”‚   â””â”€â”€ PriceExtractor.ts           # ê°€ê²© ì¶”ì¶œ
â”‚   â”‚       â”œâ”€â”€ tracking/
â”‚   â”‚       â”‚   â””â”€â”€ CrawlingHistoryTracker.ts   # âœ… íˆìŠ¤í† ë¦¬ ì¶”ì 
â”‚   â”‚       â”œâ”€â”€ utils/
â”‚   â”‚       â”‚   â””â”€â”€ pathUtils.ts                # âœ… ê²½ë¡œ ìœ í‹¸ë¦¬í‹° (ì‹ ê·œ)
â”‚   â”‚       â””â”€â”€ types/
â”‚   â”‚           â””â”€â”€ CrawlingTypes.ts
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ test-seoul-api.ts                   # ì„œìš¸ API í…ŒìŠ¤íŠ¸
â”‚       â””â”€â”€ test-integrated-crawling.ts         # âœ… í†µí•© í¬ë¡¤ë§ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ)
â””â”€â”€ data/
    â””â”€â”€ gyms_raw.json                           # âœ… ìµœì¢… ë°ì´í„° ì €ì¥ ìœ„ì¹˜
```

## ğŸ¯ ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì„œìš¸ì‹œ ê³µê³µ API       â”‚
â”‚  (LOCALDATA_104201)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ (ì˜ì—…ì¤‘ + í—¬ìŠ¤ì¥ í•„í„°ë§)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PublicApiSource        â”‚
â”‚  - ë°ì´í„° ìˆ˜ì§‘          â”‚
â”‚  - í•„í„°ë§ ì ìš©          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ (ProcessedGymData[])
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gyms_raw.json (1ì°¨)    â”‚
â”‚  - ê³µê³µ API ë°ì´í„° ì €ì¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ (name ê¸°ë°˜ í¬ë¡¤ë§)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OptimizedGymCrawling    â”‚
â”‚ - 5ê°œ ê²€ìƒ‰ ì—”ì§„ ë³‘ë ¬    â”‚
â”‚ - êµì°¨ ê²€ì¦             â”‚
â”‚ - ì‹ ë¢°ë„ ê³„ì‚°           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ (EnhancedGymInfo[])
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EnhancedDataMerger     â”‚
â”‚  - ë°ì´í„° ë³‘í•©          â”‚
â”‚  - ì¶©ëŒ í•´ê²°            â”‚
â”‚  - í’ˆì§ˆ ê²€ì‚¬            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“ (ë³‘í•©ëœ ë°ì´í„°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gyms_raw.json (ìµœì¢…)   â”‚
â”‚  - ì™„ì „í•œ í—¬ìŠ¤ì¥ ì •ë³´   â”‚
â”‚  - ë†’ì€ ì‹ ë¢°ë„          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸

### 1. gyms_raw.json íŒŒì¼ í™•ì¸
```bash
cat src/data/gyms_raw.json
```

### 2. í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ í™•ì¸
```bash
cat logs/crawling-history.json
```

### 3. ë°ì´í„° í’ˆì§ˆ í™•ì¸
- âœ… `name`: í—¬ìŠ¤ì¥ ì´ë¦„
- âœ… `address`: ì£¼ì†Œ
- âœ… `phone`: ì „í™”ë²ˆí˜¸ (í¬ë¡¤ë§ìœ¼ë¡œ ë³´ê°•)
- âœ… `price`: ê°€ê²© ì •ë³´ (í¬ë¡¤ë§ìœ¼ë¡œ ì¶”ê°€)
- âœ… `facilities`: ì‹œì„¤ ì •ë³´ (í¬ë¡¤ë§ìœ¼ë¡œ ì¶”ê°€)
- âœ… `confidence`: ì‹ ë¢°ë„ ì ìˆ˜ (0.0 ~ 1.0)
- âœ… `source`: ë°ì´í„° ì¶œì²˜

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **API í‚¤ í™•ì¸**
   - `SEOUL_OPENAPI_KEY`ê°€ `.env` ë˜ëŠ” `env.development`ì— ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•¨
   - í˜„ì¬ ì„¤ì •ëœ í‚¤: ``

2. **ì›¹ í¬ë¡¤ë§ ì œí•œ**
   - ê²€ìƒ‰ ì—”ì§„ì˜ ìš”ì²­ ì œí•œì„ ê³ ë ¤í•˜ì—¬ `delayBetweenBatches` ì„¤ì •
   - ë„ˆë¬´ ë¹ ë¥¸ ìš”ì²­ì€ ì°¨ë‹¨ë  ìˆ˜ ìˆìŒ

3. **ë°ì´í„° ë°±ì—…**
   - í¬ë¡¤ë§ ì „ `gyms_raw.json` ë°±ì—… ê¶Œì¥
   - íˆìŠ¤í† ë¦¬ëŠ” `logs/crawling-history.json`ì— ìë™ ì €ì¥

## ğŸ‰ ê²°ë¡ 

### âœ… ëª¨ë“  í¬ë¡¤ë§ ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!

1. âœ… **ì„œìš¸ API ë¶ˆëŸ¬ì˜¤ê¸°**: `PublicApiSource.ts`ì—ì„œ ì •ìƒ ë™ì‘
2. âœ… **ì›¹ í¬ë¡¤ë§**: `OptimizedGymCrawlingSource.ts`ì—ì„œ 5ê°œ ê²€ìƒ‰ ì—”ì§„ ë³‘ë ¬ í¬ë¡¤ë§
3. âœ… **ë°ì´í„° ì¡°í•©**: `EnhancedDataMerger.ts`ì—ì„œ ìŠ¤ë§ˆíŠ¸ ë³‘í•©
4. âœ… **gyms_raw.json ì—…ë°ì´íŠ¸**: ê²½ë¡œ ë¬¸ì œ ìˆ˜ì • ì™„ë£Œ

### ğŸ”§ ìˆ˜ì • ì™„ë£Œ ì‚¬í•­

1. âœ… íŒŒì¼ ê²½ë¡œ ë¬¸ì œ í•´ê²° (`pathUtils.ts` ìƒì„±)
2. âœ… ëª¨ë“  íŒŒì¼ ê²½ë¡œë¥¼ í†µì¼ëœ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¡œ ë³€ê²½
3. âœ… í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (`test-integrated-crawling.ts`)
4. âœ… Linter ì˜¤ë¥˜ ì—†ìŒ

### ğŸš€ ë‹¤ìŒ ì‹¤í–‰ ë‹¨ê³„

```bash
# 1. ë°±ì—”ë“œ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd src/backend

# 2. í†µí•© í¬ë¡¤ë§ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx ts-node scripts/test-integrated-crawling.ts

# 3. ê²°ê³¼ í™•ì¸
cat ../../src/data/gyms_raw.json
```

---

**ì‘ì„±ì¼**: 2025-10-16  
**ì‘ì„±ì**: AI Assistant  
**ë²„ì „**: 1.0

