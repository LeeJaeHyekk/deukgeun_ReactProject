// 최적화된 인터페이스 정의
export interface SeoulGu {
  gu: string
  dong: string[]
  stations: string[]
}

export interface StationInfo {
  name: string
  gu: string
}

export interface DongInfo {
  name: string
  gu: string
}

// 검색 최적화를 위한 인덱스 구조
export interface SeoulSearchIndex {
  // 역명으로 빠른 검색을 위한 Map
  stationToGu: Map<string, string>
  // 동명으로 빠른 검색을 위한 Map
  dongToGu: Map<string, string>
  // 구별 상세 정보
  guDetails: Map<string, SeoulGu>
  // 모든 역 목록 (중복 제거)
  allStations: string[]
  // 모든 동 목록 (중복 제거)
  allDongs: string[]
}

// 원본 데이터 (기존 구조 유지)
export const seoulGuStationList: SeoulGu[] = [
  {
    gu: '강남구',
    dong: [
      '개포1동',
      '개포2동',
      '개포4동',
      '논현1동',
      '논현2동',
      '대치1동',
      '대치2동',
      '대치4동',
      '도곡1동',
      '도곡2동',
      '삼성1동',
      '삼성2동',
      '세곡동',
      '수서동',
      '신사동',
      '압구정동',
      '역삼1동',
      '역삼2동',
      '일원본동',
      '일원1동',
      '일원2동',
      '청담동',
    ],
    stations: [
      '개포동역',
      '강남구청역',
      '강남역',
      '개포산성역',
      '논현역',
      '대치역',
      '도곡역',
      '매봉역',
      '봉은사역',
      '삼성역',
      '삼성중앙역',
      '선릉역',
      '선정릉역',
      '수서역',
      '신논현역',
      '신사역',
      '압구정역',
      '언주역',
      '역삼역',
      '일원역',
      '청담역',
      '학동역',
    ],
  },
  {
    gu: '강동구',
    dong: [
      '강일동',
      '고덕1동',
      '고덕2동',
      '길동',
      '둔촌1동',
      '둔촌2동',
      '명일1동',
      '명일2동',
      '상일1동',
      '상일2동',
      '성내1동',
      '성내2동',
      '성내3동',
      '암사1동',
      '암사2동',
      '암사3동',
      '천호1동',
      '천호2동',
      '천호3동',
    ],
    stations: [
      '강동역',
      '강동구청역',
      '강일역',
      '굽은다리역',
      '고덕역',
      '길동역',
      '둔촌동역',
      '둔촌오륜역',
      '명일역',
      '상일동역',
      '암사역',
      '중앙보훈병원역',
      '천호역',
    ],
  },
  {
    gu: '강북구',
    dong: [
      '미아동',
      '번1동',
      '번2동',
      '번3동',
      '삼각산동',
      '삼양동',
      '송중동',
      '송천동',
      '수유1동',
      '수유2동',
      '수유3동',
      '우이동',
      '인수동',
    ],
    stations: [
      '미아역',
      '미아사거리역',
      '수유역',
      '수유산역',
      '송중역',
      '월계역',
    ],
  },
  {
    gu: '강서구',
    dong: [
      '가양1동',
      '가양2동',
      '가양3동',
      '공항동',
      '등촌1동',
      '등촌2동',
      '등촌3동',
      '발산1동',
      '방화1동',
      '방화2동',
      '방화3동',
      '염창동',
      '우장산동',
      '화곡본동',
      '화곡1동',
      '화곡2동',
      '화곡3동',
      '화곡4동',
      '화곡6동',
      '화곡8동',
    ],
    stations: [
      '가양역',
      '개화역',
      '개화산역',
      '공항시장역',
      '김포공항역',
      '까치산역',
      '등촌역',
      '마곡역',
      '마곡나루역',
      '발산역',
      '방화역',
      '송정역',
      '신방화역',
      '양천향교역',
      '염창역',
      '우장산역',
      '증미역',
      '화곡역',
    ],
  },
  {
    gu: '관악구',
    dong: [
      '낙성대동',
      '난곡동',
      '난향동',
      '남현동',
      '대학동',
      '미성동',
      '보라매동',
      '삼성동',
      '서림동',
      '서원동',
      '성현동',
      '신림동',
      '신사동',
      '신원동',
      '은천동',
      '인헌동',
      '조원동',
      '중앙동',
      '청룡동',
      '청림동',
      '행운동',
    ],
    stations: [
      '낙성대역',
      '대학동역',
      '보라매역',
      '신림역',
      '서울대입구역',
      '언남역',
      '봉천역',
    ],
  },
  {
    gu: '광진구',
    dong: [
      '광장동',
      '구의1동',
      '구의2동',
      '구의3동',
      '군자동',
      '능동',
      '자양1동',
      '자양2동',
      '자양3동',
      '자양4동',
      '중곡1동',
      '중곡2동',
      '중곡3동',
      '중곡4동',
      '화양동',
    ],
    stations: [
      '건대입구역',
      '군자역',
      '구의역',
      '광나루역',
      '능동역',
      '어린이대공원역',
      '자양역',
      '중곡역',
      '행당역',
      '왕십리역',
      '뚝섬유원지역',
      '왕십리역복합환승센터역',
      '구의능동역',
      '광진구청역',
      '잠실나루역',
      '잠실새내역',
    ],
  },
  {
    gu: '구로구',
    dong: [
      '가리봉동',
      '개봉1동',
      '개봉2동',
      '개봉3동',
      '고척1동',
      '고척2동',
      '구로1동',
      '구로2동',
      '구로3동',
      '구로4동',
      '구로5동',
      '수궁동',
      '신도림동',
      '오류1동',
      '오류2동',
      '천왕동',
      '항동',
    ],
    stations: [
      '개봉역',
      '구로역',
      '구로디지털단지역',
      '구일역',
      '남구로역',
      '대림역',
      '도림천역',
      '신도림역',
      '오류동역',
      '온수역',
      '천왕역',
    ],
  },
  {
    gu: '금천구',
    dong: [
      '가산동',
      '독산1동',
      '독산2동',
      '독산3동',
      '독산4동',
      '시흥1동',
      '시흥2동',
      '시흥3동',
      '시흥4동',
      '시흥5동',
    ],
    stations: ['금천구청역'],
  },
  {
    gu: '노원구',
    dong: [
      '공릉1동',
      '공릉2동',
      '상계1동',
      '상계2동',
      '상계3·4동',
      '상계5동',
      '상계6·7동',
      '상계8동',
      '상계9동',
      '상계10동',
      '월계1동',
      '월계2동',
      '월계3동',
      '중계본동',
      '중계1동',
      '중계2·3동',
      '중계4동',
      '하계1동',
      '하계2동',
      '하계3동',
      '중계본동',
      '중계1동',
      '중계2·3동',
      '중계4동',
      '하계1동',
      '하계2동',
      '하계3동',
    ],
    stations: [
      '공릉역',
      '광운대역',
      '노원역',
      '당고개역',
      '마들역',
      '상계역',
      '석계역',
      '수락산역',
      '월계역',
      '중계역',
      '태릉입구역',
      '하계역',
      '화랑대역',
    ],
  },
  {
    gu: '도봉구',
    dong: [
      '도봉1동',
      '도봉2동',
      '방학1동',
      '방학2동',
      '방학3동',
      '쌍문1동',
      '쌍문2동',
      '쌍문3동',
      '쌍문4동',
      '창1동',
      '창2동',
      '창3동',
      '창4동',
      '창5동',
    ],
    stations: [
      '도봉역',
      '도봉산역',
      '수락산역',
      '창동역',
      '방학역',
      '회룡역',
      '방학동역',
      '도봉구청역',
      '무악재역',
      '신창동역',
      '신창역',
    ],
  },
  {
    gu: '동대문구',
    dong: [
      '답십리1동',
      '답십리2동',
      '용신동',
      '이문1동',
      '이문2동',
      '장안1동',
      '장안2동',
      '전농1동',
      '전농2동',
      '제기동',
      '청량리동',
      '회기동',
      '휘경1동',
      '휘경2동',
    ],
    stations: [
      '동대문역',
      '동대문역사문화공원역',
      '신설동역',
      '제기동역',
      '청량리역',
      '답십리역',
      '장한평역',
      '장안동역',
      '휘경역',
      '회기역',
      '이문역',
      '외대앞역',
      '회기역복합환승센터역',
      '청량리종합역',
      '동묘앞역',
    ],
  },
  {
    gu: '동작구',
    dong: [
      '노량진1동',
      '노량진2동',
      '대방동',
      '사당1동',
      '사당2동',
      '사당3동',
      '사당4동',
      '사당5동',
      '상도1동',
      '상도2동',
      '상도3동',
      '상도4동',
      '신대방1동',
      '신대방2동',
      '흑석동',
    ],
    stations: [
      '남성역',
      '노들역',
      '노량진역',
      '동작역',
      '보라매역',
      '보라매공원역',
      '신대방역',
      '신대방삼거리역',
      '사당역',
      '상도역',
      '흑석역',
      '이수역',
      '장승배기역',
      '신길역',
      '노후역',
    ],
  },
  {
    gu: '마포구',
    dong: [
      '공덕동',
      '대흥동',
      '도화동',
      '망원1동',
      '망원2동',
      '상암동',
      '서강동',
      '서교동',
      '성산1동',
      '성산2동',
      '신수동',
      '아현동',
      '연남동',
      '염리동',
      '용강동',
      '합정동',
    ],
    stations: [
      '공덕역',
      '광흥창역',
      '대흥역',
      '디지털미디어시티역',
      '마포역',
      '마포구청역',
      '망원역',
      '상수역',
      '서강대역',
      '신촌역',
      '아현역',
      '애오개역',
      '월드컵경기장역',
      '이대역',
      '합정역',
      '홍대입구역',
    ],
  },
  {
    gu: '서대문구',
    dong: [
      '남가좌1동',
      '남가좌2동',
      '북가좌1동',
      '북가좌2동',
      '북아현동',
      '신촌동',
      '연희동',
      '천연동',
      '충현동',
      '홍은1동',
      '홍은2동',
      '홍제1동',
      '홍제2동',
      '홍제3동',
    ],
    stations: [
      '광흥창역',
      '공덕역',
      '독립문역',
      '무악재역',
      '서대문역',
      '신촌역',
      '아현역',
      '연희맛길역',
      '이대역',
      '충정로역',
      '홍대입구역',
      '홍은역',
      '홍제역',
      '남가좌역',
      '북가좌역',
    ],
  },
  {
    gu: '서초구',
    dong: [
      '내곡동',
      '반포1동',
      '반포2동',
      '반포3동',
      '반포4동',
      '반포본동',
      '방배1동',
      '방배2동',
      '방배3동',
      '방배4동',
      '방배본동',
      '서초1동',
      '서초2동',
      '서초3동',
      '서초4동',
      '양재1동',
      '양재2동',
      '잠원동',
    ],
    stations: [
      '교대역',
      '남부터미널역',
      '내방역',
      '논현역',
      '매봉역',
      '반포역',
      '방배역',
      '사평역',
      '서초역',
      '신논현역',
      '신반포역',
      '양재역',
      '양재시민의숲역',
      '우면산역',
      '잠원역',
      '청계산입구역',
      '총신대입구역',
      '한티역',
    ],
  },
  {
    gu: '성동구',
    dong: [
      '금호1가동',
      '금호2·3가동',
      '금호4가동',
      '도선동',
      '마장동',
      '사근동',
      '성수1가1동',
      '성수1가2동',
      '성수2가1동',
      '성수2가3동',
      '송정동',
      '옥수동',
      '왕십리도선동',
      '왕십리2동',
      '용답동',
      '뚝섬동',
      '답십리1동',
      '답십리2동',
      '신답동',
    ],
    stations: [
      '금호역',
      '마장역',
      '왕십리역',
      '상왕십리역',
      '서울숲역',
      '성수역',
      '응봉역',
      '옥수역',
      '한양대역',
      '행당역',
      '용답역',
      '뚝섬역',
      '답십리역',
      '신답역',
    ],
  },
  {
    gu: '성북구',
    dong: [
      '길음1동',
      '길음2동',
      '돈암1동',
      '돈암2동',
      '동선동',
      '보문동',
      '삼선동',
      '석관동',
      '성북동',
      '안암동',
      '월곡1동',
      '월곡2동',
      '장위1동',
      '장위2동',
      '장위3동',
      '정릉1동',
      '정릉2동',
      '정릉3동',
      '정릉4동',
      '종암동',
    ],
    stations: [
      '길음역',
      '돌곶이역',
      '보문역',
      '삼양사거리역',
      '삼양역',
      '상월곡역',
      '석계역',
      '성신여대입구역',
      '안암역',
      '월곡역',
      '정릉역',
      '종암역',
      '한성대입구역',
    ],
  },
  {
    gu: '송파구',
    dong: [
      '가락1동',
      '가락2동',
      '가락본동',
      '거여1동',
      '거여2동',
      '마천1동',
      '마천2동',
      '문정1동',
      '문정2동',
      '방이1동',
      '방이2동',
      '삼전동',
      '석촌동',
      '송파1동',
      '송파2동',
      '오금동',
      '오륜동',
      '위례동',
      '잠실2동',
      '잠실3동',
      '잠실4동',
      '잠실6동',
      '잠실7동',
      '잠실본동',
      '장지동',
      '풍납1동',
      '풍납2동',
    ],
    stations: [
      '가락시장역',
      '개롱역',
      '경찰병원역',
      '거여역',
      '문정역',
      '방이역',
      '석촌역',
      '석촌고분역',
      '송파역',
      '송파나루역',
      '잠실역',
      '잠실새내역',
      '잠실나루역',
      '잠실역(롯데월드)',
      '장지역',
      '올림픽공원역',
      '풍납토성역',
    ],
  },
  {
    gu: '양천구',
    dong: [
      '목1동',
      '목2동',
      '목3동',
      '목4동',
      '목5동',
      '신월1동',
      '신월2동',
      '신월3동',
      '신월4동',
      '신월5동',
      '신월6동',
      '신월7동',
      '신정1동',
      '신정2동',
      '신정3동',
      '신정4동',
      '신정6동',
      '신정7동',
    ],
    stations: [
      '목동역',
      '오목교역',
      '양천구청역',
      '신정역',
      '신정네거리역',
      '까치산역',
      '등촌역',
      '화곡역',
    ],
  },
  {
    gu: '영등포구',
    dong: [
      '당산1동',
      '당산2동',
      '대림1동',
      '대림2동',
      '대림3동',
      '도림동',
      '문래동',
      '신길1동',
      '신길3동',
      '신길4동',
      '신길5동',
      '신길6동',
      '신길7동',
      '양평1동',
      '양평2동',
      '여의동',
      '영등포본동',
      '영등포동',
    ],
    stations: [
      '당산역',
      '도림천역',
      '문래역',
      '보라매역',
      '샛강역',
      '신길역',
      '신풍역',
      '영등포역',
      '영등포구청역',
      '영등포시장역',
      '여의나루역',
      '여의도역',
      '여의도한강공원역',
      '양평역',
      '선유도역',
      '대림역',
    ],
  },
  {
    gu: '용산구',
    dong: [
      '남영동',
      '보광동',
      '서빙고동',
      '용문동',
      '원효로1동',
      '원효로2동',
      '이촌1동',
      '이촌2동',
      '이태원1동',
      '이태원2동',
      '청파동',
      '한강로동',
      '한남동',
      '효창동',
      '후암동',
    ],
    stations: [
      '남영역',
      '녹사평역',
      '동빙고역',
      '삼각지역',
      '숙대입구역',
      '신용산역',
      '이촌역',
      '이태원역',
      '효창공원앞역',
      '용산역',
      '한강진역',
    ],
  },
  {
    gu: '은평구',
    dong: [
      '갈현1동',
      '갈현2동',
      '구산동',
      '녹번동',
      '대조동',
      '불광1동',
      '불광2동',
      '수색동',
      '역촌동',
      '응암1동',
      '응암2동',
      '응암3동',
      '증산동',
    ],
    stations: [
      '구파발역',
      '녹번역',
      '불광역',
      '새절역',
      '연신내역',
      '역촌역',
      '응암역',
      '구산역',
      '독바위역',
      '불광동역',
      '증산역',
      '진관역',
    ],
  },
  {
    gu: '종로구',
    dong: [
      '가회동',
      '공평동',
      '관수동',
      '관철동',
      '교남동',
      '교북동',
      '견지동',
      '경운동',
      '계동',
      '권농동',
      '낙원동',
      '내수동',
      '당주동',
      '명륜1·2동',
      '명륜3동',
      '묘동',
      '사간동',
      '사직동',
      '삼청동',
      '상계동',
      '송월동',
      '송현동',
      '숭인동',
      '와룡동',
      '옥인동',
      '용신동',
      '이화동',
      '종로1·2·3·4가동',
      '종로5·6가동',
      '창신1동',
      '창신2동',
      '창신3동',
      '청운동',
      '체부동',
      '충신동',
      '통인동',
      '혜화동',
      '홍지동',
    ],
    stations: [
      '경복궁역',
      '광화문역',
      '구기역',
      '동대문역',
      '독립문역',
      '동묘앞역',
      '안국역',
      '종각역',
      '종로3가역',
      '종로5가역',
      '종로구청역',
      '혜화역',
      '창신역',
      '청운효자동역',
      '가회동역',
      '삼청역',
      '신설동역',
      '을지로4가역',
      '종로문화역',
      '종각시민광장역',
    ],
  },
  {
    gu: '중구',
    dong: [
      '광희동',
      '남대문로1가동',
      '남대문로2가동',
      '남대문로3가동',
      '남대문로4가동',
      '다산동',
      '무교동',
      '방산동',
      '봉래동1가',
      '봉래동2가',
      '북창동',
      '신당동',
      '소공동',
      '수표동',
      '신당5동',
      '신당6동',
      '약수동',
      '예장동',
      '오장동',
      '을지로동',
      '입정동',
      '중림동',
      '중앙동',
      '주교동',
      '충무로1가동',
      '충무로2가동',
    ],
    stations: [
      '명동역',
      '서울역',
      '서울역환승센터역',
      '을지로입구역',
      '을지로3가역',
      '을지로4가역',
      '동대문역사문화공원역',
      '충무로역',
      '회현역',
      '신당역',
      '청구역',
      '약수역',
      '동대입구역',
      '버티고개역',
      '숭례문역',
      '남산역',
      '소공동역',
    ],
  },
  {
    gu: '중랑구',
    dong: [
      '망우본동',
      '망우1동',
      '망우2동',
      '면목본동',
      '면목1동',
      '면목2동',
      '면목3동',
      '면목4동',
      '면목5동',
      '면목7동',
      '상봉1동',
      '상봉2동',
      '신내1동',
      '신내2동',
      '중화1동',
      '중화2동',
    ],
    stations: [
      '망우역',
      '면목역',
      '먹골역',
      '사가정역',
      '상봉역',
      '신내역',
      '중랑역',
      '중화역',
      '용마산역',
      '양원역',
    ],
  },
]

// 검색 최적화를 위한 인덱스 생성 함수
function createSeoulSearchIndex(): SeoulSearchIndex {
  const stationToGu = new Map<string, string>()
  const dongToGu = new Map<string, string>()
  const guDetails = new Map<string, SeoulGu>()
  const allStations = new Set<string>()
  const allDongs = new Set<string>()

  // 원본 데이터를 순회하며 인덱스 생성
  seoulGuStationList.forEach(guData => {
    // 구별 상세 정보 저장
    guDetails.set(guData.gu, guData)

    // 역명 인덱스 생성
    guData.stations.forEach(station => {
      stationToGu.set(station, guData.gu)
      allStations.add(station)
    })

    // 동명 인덱스 생성
    guData.dong.forEach(dong => {
      dongToGu.set(dong, guData.gu)
      allDongs.add(dong)
    })
  })

  return {
    stationToGu,
    dongToGu,
    guDetails,
    allStations: Array.from(allStations).sort(),
    allDongs: Array.from(allDongs).sort(),
  }
}

// 전역 검색 인덱스 (싱글톤 패턴)
let seoulSearchIndex: SeoulSearchIndex | null = null

// 검색 인덱스 초기화 및 반환
function getSeoulSearchIndex(): SeoulSearchIndex {
  if (!seoulSearchIndex) {
    seoulSearchIndex = createSeoulSearchIndex()
  }
  return seoulSearchIndex
}

// 검색 유틸리티 함수들
export const SeoulSearchUtils = {
  // 역명으로 구 찾기
  findGuByStation(stationName: string): string | null {
    const index = getSeoulSearchIndex()
    return index.stationToGu.get(stationName) || null
  },

  // 동명으로 구 찾기
  findGuByDong(dongName: string): string | null {
    const index = getSeoulSearchIndex()
    return index.dongToGu.get(dongName) || null
  },

  // 구별 상세 정보 조회
  getGuDetails(guName: string): SeoulGu | null {
    const index = getSeoulSearchIndex()
    return index.guDetails.get(guName) || null
  },

  // 역명으로 검색 (부분 일치)
  searchStations(query: string): StationInfo[] {
    const index = getSeoulSearchIndex()
    const results: StationInfo[] = []

    index.allStations.forEach(station => {
      if (station.includes(query)) {
        const gu = index.stationToGu.get(station)
        if (gu) {
          results.push({ name: station, gu })
        }
      }
    })

    return results
  },

  // 동명으로 검색 (부분 일치)
  searchDongs(query: string): DongInfo[] {
    const index = getSeoulSearchIndex()
    const results: DongInfo[] = []

    index.allDongs.forEach(dong => {
      if (dong.includes(query)) {
        const gu = index.dongToGu.get(dong)
        if (gu) {
          results.push({ name: dong, gu })
        }
      }
    })

    return results
  },

  // 모든 역 목록 반환
  getAllStations(): string[] {
    const index = getSeoulSearchIndex()
    return [...index.allStations]
  },

  // 모든 동 목록 반환
  getAllDongs(): string[] {
    const index = getSeoulSearchIndex()
    return [...index.allDongs]
  },

  // 모든 구 목록 반환
  getAllGus(): string[] {
    return seoulGuStationList.map(gu => gu.gu)
  },

  // 구별 역 개수 반환
  getStationCountByGu(guName: string): number {
    const guData = this.getGuDetails(guName)
    return guData ? guData.stations.length : 0
  },

  // 구별 동 개수 반환
  getDongCountByGu(guName: string): number {
    const guData = this.getGuDetails(guName)
    return guData ? guData.dong.length : 0
  },

  // 통합 검색 (역명 또는 동명으로 검색)
  searchAll(query: string): { stations: StationInfo[]; dongs: DongInfo[] } {
    return {
      stations: this.searchStations(query),
      dongs: this.searchDongs(query),
    }
  },

  // 인덱스 재생성 (데이터 업데이트 시 사용)
  refreshIndex(): void {
    seoulSearchIndex = createSeoulSearchIndex()
  },
}

// 기존 호환성을 위한 레거시 함수들
export function findGuByStation(stationName: string): string | null {
  return SeoulSearchUtils.findGuByStation(stationName)
}

export function findGuByDong(dongName: string): string | null {
  return SeoulSearchUtils.findGuByDong(dongName)
}

export function getGuDetails(guName: string): SeoulGu | null {
  return SeoulSearchUtils.getGuDetails(guName)
}
