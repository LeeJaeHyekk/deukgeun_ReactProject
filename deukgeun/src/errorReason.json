{
  "problemDescription": "ëª¨ë‹¬ì—ì„œ ëŒ“ê¸€ì„ ì¶”ê°€/ì‚­ì œí•´ë„ í˜ì´ì§€ì˜ ëŒ“ê¸€ ìˆ˜ê°€ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•ŠìŒ. ëª¨ë‹¬ ì¢…ë£Œ í›„ì—ì•¼ ì—…ë°ì´íŠ¸ë¨.",
  "analysis": {
    "expectedBehavior": "ëª¨ë‹¬ì—ì„œ ëŒ“ê¸€ ì¶”ê°€/ì‚­ì œ ì‹œ í˜ì´ì§€(PostCard)ì˜ ëŒ“ê¸€ ìˆ˜ê°€ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•¨",
    "actualBehavior": "ëª¨ë‹¬ì—ì„œ ëŒ“ê¸€ì„ ì¶”ê°€í•´ë„ í˜ì´ì§€ì˜ ëŒ“ê¸€ ìˆ˜ëŠ” ê¸°ì¡´ ê°’ ìœ ì§€, ëª¨ë‹¬ ì¢…ë£Œ í›„ì—ì•¼ ì—…ë°ì´íŠ¸ë¨",
    "rootCause": "í˜ì´ì§€ì™€ ëª¨ë‹¬ì˜ ëŒ“ê¸€ ì¹´ìš´íŠ¸ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠìŒ"
  },
  "codeAnalysis": {
    "commentsSelectors": {
      "file": "src/frontend/features/community/comments/commentsSelectors.ts",
      "selectDisplayCommentCount": {
        "code": "export const selectDisplayCommentCount = createSelector(\n  [\n    (s: RootState, postId: number) => selectPostCommentCount(s, postId),\n    (s: RootState, postId: number) => selectOptimisticCommentsForPost(s, postId),\n  ],\n  (serverCount, optimisticComments) => {\n    const optimisticDelta = optimisticComments.length\n    const displayCount = serverCount + optimisticDelta\n    \n    if (process.env.NODE_ENV === 'development') {\n      console.log('ğŸ” [commentsSelectors] ëŒ“ê¸€ ìˆ˜ ê³„ì‚°:', {\n        serverCount,\n        optimisticDelta,\n        displayCount\n      })\n    }\n    \n    return displayCount\n  }\n)",
        "logic": "postsSlice.commentCount + commentsSlice.optimisticTemp.length",
        "status": "âœ… ì •í™•í•œ í•©ì‚° ë¡œì§ êµ¬í˜„ë¨"
      },
      "selectPostCommentCount": {
        "code": "export const selectPostCommentCount = (state: RootState, postId: number) =>\n  state.posts.entities[postId]?.commentCount ?? 0",
        "purpose": "ì„œë²„ì—ì„œ ë°›ì€ ëŒ“ê¸€ ìˆ˜ (posts.entities[postId].commentCount)"
      },
      "selectOptimisticCommentsForPost": {
        "code": "export const selectOptimisticCommentsForPost = (state: RootState, postId: number) =>\n  state.comments.optimisticTemp[postId] ?? []",
        "purpose": "ë‚™ê´€ì  ëŒ“ê¸€ ëª©ë¡ (ì„œë²„ í™•ì • ì „ ì„ì‹œ ëŒ“ê¸€)"
      }
    },
    "postsSlice": {
      "file": "src/frontend/features/community/posts/postsSlice.ts",
      "commentCountReducers": {
        "incrementCommentCount": {
          "code": "incrementCommentCount: (state, action: PayloadAction<{ postId: number }>) => {\n  const { postId } = action.payload\n  const post = state.entities[postId]\n  if (post) {\n    if (post.commentCount == null) post.commentCount = 0\n    post.commentCount += 1\n    console.log('ğŸ“ [postsSlice] ëŒ“ê¸€ ìˆ˜ ì¦ê°€:', { postId, newCount: post.commentCount })\n  }\n}",
          "purpose": "ë‚™ê´€ì  ëŒ“ê¸€ ì¶”ê°€ ì‹œ ì¦‰ì‹œ ëŒ“ê¸€ ìˆ˜ ì¦ê°€"
        },
        "decrementCommentCount": {
          "code": "decrementCommentCount: (state, action: PayloadAction<{ postId: number }>) => {\n  const { postId } = action.payload\n  const post = state.entities[postId]\n  if (post) {\n    if (post.commentCount == null) post.commentCount = 0\n    post.commentCount = Math.max(0, post.commentCount - 1)\n    console.log('ğŸ“ [postsSlice] ëŒ“ê¸€ ìˆ˜ ê°ì†Œ:', { postId, newCount: post.commentCount })\n  }\n}",
          "purpose": "ëŒ“ê¸€ ì‚­ì œ ì‹œ ë˜ëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ ëŒ“ê¸€ ìˆ˜ ê°ì†Œ"
        },
        "setCommentCount": {
          "code": "setCommentCount: (state, action: PayloadAction<{ postId: number; count: number }>) => {\n  const { postId, count } = action.payload\n  const post = state.entities[postId]\n  if (post) {\n    post.commentCount = count\n    console.log('ğŸ“ [postsSlice] ëŒ“ê¸€ ìˆ˜ ì„¤ì •:', { postId, count })\n  }\n}",
          "purpose": "ì„œë²„ ì‘ë‹µìœ¼ë¡œ ë°›ì€ ì •í™•í•œ ëŒ“ê¸€ ìˆ˜ë¡œ ì„¤ì •"
        }
      }
    },
    "postCard": {
      "file": "src/frontend/features/community/components/PostCard.tsx",
      "commentCountUsage": {
        "code": "const displayCommentCount = useSelector((state: RootState) => selectDisplayCommentCount(state, post.id))",
        "purpose": "í†µí•© ëŒ“ê¸€ ìˆ˜ ê°€ì ¸ì˜¤ê¸° (ì„œë²„ ìˆ˜ + ë‚™ê´€ì  ë¸íƒ€)",
        "status": "âœ… ì˜¬ë°”ë¥¸ selector ì‚¬ìš©"
      },
      "rendering": {
        "code": "<span className={styles.commentCount}>\n  ğŸ’¬ {displayCommentCount}\n</span>",
        "purpose": "ëŒ“ê¸€ ìˆ˜ í‘œì‹œ"
      }
    },
    "postDetailModal": {
      "file": "src/frontend/features/community/components/postDetail/PostDetailModal.tsx",
      "commentCountUsage": {
        "code": "const displayCommentCount = useSelector((state: RootState) => selectDisplayCommentCount(state, post.id))",
        "purpose": "í†µí•© ëŒ“ê¸€ ìˆ˜ ê°€ì ¸ì˜¤ê¸° (ì„œë²„ ìˆ˜ + ë‚™ê´€ì  ë¸íƒ€)",
        "status": "âœ… ì˜¬ë°”ë¥¸ selector ì‚¬ìš©"
      },
      "rendering": {
        "code": "<PostActions\n  post={{...post, commentCount: displayCommentCount}}\n  isAuthor={isAuthor}\n  onEdit={() => setIsEditing(true)}\n  onDelete={handleDeletePost}\n  onComment={scrollToComments}\n/>",
        "purpose": "ëŒ“ê¸€ ìˆ˜ë¥¼ PostActionsì— ì „ë‹¬"
      }
    },
    "addCommentOptimisticThunk": {
      "file": "src/frontend/features/community/comments/commentsSlice.ts",
      "code": "export const addCommentOptimisticThunk = (postId: number, content: string) => \n  async (dispatch: AppDispatch, getState: () => RootState) => {\n    const tempId = Date.now() * -1\n    const user = getState().auth.user\n    if (!user) {\n      throw new Error('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.')\n    }\n\n    const tempComment: Comment = {\n      id: tempId,\n      postId,\n      content,\n      userId: user.id,\n      author: { \n        id: user.id, \n        nickname: user.nickname || 'ìµëª…'\n      },\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      likesCount: 0,\n    }\n\n    // 1. ë‚™ê´€ì  ëŒ“ê¸€ ì¶”ê°€\n    dispatch(addCommentOptimistic({ postId, tempComment }))\n    // 2. postsSliceì˜ ëŒ“ê¸€ ìˆ˜ ì¦‰ì‹œ ì¦ê°€\n    dispatch(incrementCommentCount({ postId }))\n\n    try {\n      const response = await axios.post(`/api/posts/${postId}/comments`, { content })\n      const confirmed: Comment = response.data.data.comment\n      const serverCount: number = response.data.data.commentCount\n\n      // 3. ì„œë²„ í™•ì • í›„ ì‹¤ì œ ëŒ“ê¸€ ì¶”ê°€\n      dispatch(addCommentConfirmed(confirmed))\n      // 4. ë‚™ê´€ì  ëŒ“ê¸€ ì œê±°\n      dispatch(removeOptimisticComment({ postId, tempId }))\n      // 5. ì„œë²„ì—ì„œ ë°›ì€ ì •í™•í•œ ëŒ“ê¸€ ìˆ˜ë¡œ ì„¤ì •\n      dispatch(setCommentCount({ postId, count: serverCount }))\n      \n      console.log('ğŸ”¥ [commentsSlice] ëŒ“ê¸€ ì¶”ê°€ ì„±ê³µ:', { postId, commentId: confirmed.id })\n    } catch (error) {\n      // 6. ì‹¤íŒ¨ ì‹œ ë‚™ê´€ì  ëŒ“ê¸€ ì œê±° ë° ëŒ“ê¸€ ìˆ˜ ë³µì›\n      dispatch(removeOptimisticComment({ postId, tempId }))\n      dispatch(decrementCommentCount({ postId }))\n      console.error('ğŸ”¥ [commentsSlice] ëŒ“ê¸€ ì¶”ê°€ ì‹¤íŒ¨:', error)\n      throw error\n    }\n  }",
      "flow": {
        "step1": "ë‚™ê´€ì  ëŒ“ê¸€ ì¶”ê°€ (commentsSlice.optimisticTemp)",
        "step2": "postsSlice ëŒ“ê¸€ ìˆ˜ ì¦‰ì‹œ ì¦ê°€ (incrementCommentCount)",
        "step3": "ì„œë²„ ìš”ì²­",
        "step4_success": "ì„œë²„ í™•ì • í›„ ì‹¤ì œ ëŒ“ê¸€ ì¶”ê°€ + ë‚™ê´€ì  ëŒ“ê¸€ ì œê±° + ì •í™•í•œ ëŒ“ê¸€ ìˆ˜ ì„¤ì •",
        "step4_failure": "ë‚™ê´€ì  ëŒ“ê¸€ ì œê±° + ëŒ“ê¸€ ìˆ˜ ë³µì›"
      },
      "status": "âœ… ì˜¬ë°”ë¥¸ ë™ê¸°í™” ë¡œì§ êµ¬í˜„ë¨"
    },
    "useComments": {
      "file": "src/frontend/features/community/hooks/useComments.ts",
      "commentSubmission": {
        "code": "const handleSubmitComment = useCallback(async () => {\n  if (!newComment.trim()) {\n    showToast('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error')\n    return\n  }\n\n  try {\n    // ìƒˆë¡œìš´ thunk ì‚¬ìš© (ë‚™ê´€ì  ì—…ë°ì´íŠ¸ + postsSlice ì—°ë™)\n    await dispatch(addCommentOptimisticThunk(postId, newComment.trim()))\n    showToast('ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')\n    setNewComment('')\n    \n    // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (Redux ìƒíƒœëŠ” thunkì—ì„œ ìë™ ì—…ë°ì´íŠ¸ë¨)\n    await fetchComments()\n  } catch (error: unknown) {\n    console.error('ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨:', error)\n    showToast('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error')\n  }\n}, [postId, newComment, dispatch, fetchComments])",
        "purpose": "ëŒ“ê¸€ ì‘ì„± ì‹œ addCommentOptimisticThunk í˜¸ì¶œ",
        "status": "âœ… ì˜¬ë°”ë¥¸ thunk ì‚¬ìš©"
      }
    }
  },
  "potentialIssues": {
    "issue1": {
      "description": "ëª¨ë‹¬ì—ì„œ ëŒ“ê¸€ ì¶”ê°€ í›„, ì„œë²„ í™•ì • ì „ optimistic ìƒíƒœê°€ postsSlice.commentCountì— ë°˜ì˜ë˜ì§€ ì•ŠìŒ",
      "probability": "LOW",
      "reason": "addCommentOptimisticThunkì—ì„œ incrementCommentCountë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ postsSliceê°€ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë¨"
    },
    "issue2": {
      "description": "postsSlice.commentCountê°€ ëª¨ë‹¬ ì—´ê¸° ì „ ì´ˆê¸°ê°’(ì„œë²„ê°’)ìœ¼ë¡œ ê³ ì •ë˜ì–´ ìˆê³ , ëª¨ë‹¬ì—ì„œ update í›„ PostCardê°€ ì•„ì§ ìµœì‹  stateë¥¼ ë°›ì§€ ëª»í•¨",
      "probability": "MEDIUM",
      "reason": "React.memo ìµœì í™”ë¡œ ì¸í•´ propsê°€ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ì¬ë Œë”ë§ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ"
    },
    "issue3": {
      "description": "selectorê°€ commentsSlice.optimisticTempì™€ postsSlice.commentCountë¥¼ ì •í™•íˆ í•©ì‚°í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°",
      "probability": "LOW",
      "reason": "selectDisplayCommentCount ë¡œì§ì´ ì •í™•íˆ êµ¬í˜„ë˜ì–´ ìˆìŒ"
    },
    "issue4": {
      "description": "Redux ìƒíƒœ ì—…ë°ì´íŠ¸ëŠ” ë˜ì§€ë§Œ ì»´í¬ë„ŒíŠ¸ê°€ ì¬ë Œë”ë§ë˜ì§€ ì•ŠëŠ” ê²½ìš°",
      "probability": "HIGH",
      "reason": "React.memoì˜ ë¹„êµ í•¨ìˆ˜ê°€ ë„ˆë¬´ ì—„ê²©í•˜ê±°ë‚˜, useSelectorê°€ ì œëŒ€ë¡œ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŒ"
    }
  },
  "debuggingSteps": {
    "step1": "Redux DevToolsì—ì„œ ëŒ“ê¸€ ì¶”ê°€ ì‹œ ì•¡ì…˜ ìˆœì„œ í™•ì¸",
    "step2": "console.logë¡œ Redux ìƒíƒœ ìŠ¤ëƒ…ìƒ· í™•ì¸",
    "step3": "PostCardì˜ React.memo ë¹„êµ í•¨ìˆ˜ ê²€í† ",
    "step4": "useSelectorì˜ ì˜ì¡´ì„± ë°°ì—´ í™•ì¸",
    "step5": "selectDisplayCommentCountì˜ ê³„ì‚° ê²°ê³¼ ë¡œê·¸ í™•ì¸"
  },
  "recommendedActions": {
    "immediate": [
      "Redux DevToolsë¡œ ëŒ“ê¸€ ì¶”ê°€ ì‹œ ì•¡ì…˜ ìˆœì„œ í™•ì¸",
      "console.log(store.getState())ë¡œ í˜„ì¬ ìƒíƒœ ìŠ¤ëƒ…ìƒ· í™•ì¸",
      "PostCardì˜ React.memo ë¹„êµ í•¨ìˆ˜ì—ì„œ commentCount ë¹„êµ ë¡œì§ ê²€í† "
    ],
    "investigation": [
      "selectDisplayCommentCount ê³„ì‚° ê²°ê³¼ë¥¼ ìƒì„¸íˆ ë¡œê¹…",
      "PostCardê°€ ì–¸ì œ ì¬ë Œë”ë§ë˜ëŠ”ì§€ ì¶”ì ",
      "useSelectorê°€ ìƒíƒœ ë³€í™”ë¥¼ ì œëŒ€ë¡œ ê°ì§€í•˜ëŠ”ì§€ í™•ì¸"
    ],
    "potentialFixes": [
      "PostCardì˜ React.memo ë¹„êµ í•¨ìˆ˜ì—ì„œ displayCommentCount ë¹„êµ ì¶”ê°€",
      "useSelectorì— shallowEqual ë¹„êµ í•¨ìˆ˜ ì‚¬ìš©",
      "selectDisplayCommentCountì˜ ì˜ì¡´ì„± ë°°ì—´ ìµœì í™”"
    ]
  },
  "currentImplementationStatus": {
    "commentsSelectors": "âœ… ì™„ë£Œ",
    "postsSlice": "âœ… ì™„ë£Œ", 
    "addCommentOptimisticThunk": "âœ… ì™„ë£Œ",
    "postCard": "âœ… ì™„ë£Œ",
    "postDetailModal": "âœ… ì™„ë£Œ",
    "synchronization": "âœ… ì™„ë£Œ",
    "optimization": "âœ… ì™„ë£Œ"
  },
  "nextSteps": "ì‹¤ì œ Redux ìƒíƒœ ìŠ¤ëƒ…ìƒ·ê³¼ PostCard ì¬ë Œë”ë§ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ì •í™•í•œ ì›ì¸ íŒŒì•… í•„ìš”"
}
